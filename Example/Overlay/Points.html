<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>批量点绘制</title>
    <style type="text/css">
        html, body {
            padding: 0;
            margin: 0;
        }

        #container {
            width: 100%;
            height: 100%;
            position: absolute;
        }
    </style>
    <script src="../../lib/MapAPI_JavaScript.min.js"></script>
</head>
<body style="overflow:hidden">
    <div id="container"></div>
    <div class="alert alert-success" style="position:absolute;left:100px;top:20px;">
        <label>提示：</label><br />
        1.点击聚合点图标可以展开所有聚合的点。<br>
        2.点击非聚合点图标可以触发marker点的回调函数。<br>
    </div>

<script type="text/javascript">
    init()

    function init() {
        // 地图初始化
        var map = new TYMapOptions();
        map.contentId = "container";
        map.lnglat = new TYLngLat(100, 35);
        map.mapLevel = 4;
        TYInitialize(map);

        // 地图配置
        TYMapTiles( new TYTilesOptions(TYEnumMapType.TY_Google_IMG));
    }
    function addpoints(a) {
        var data = [];
        for (var i = 0; i < 50; i++) {
            var p = new TYMarker({
                pointId: "divid" + i,
                label: new TYLabel({
                    content: "<span style='color:red;border:1px solid red;background-color:blue;'>自定义的marker标签</span>",
                    offset: new TYPixel(25, 15)
                }),
                lnglat: new TYLngLat(114.08 + Math.random() * 0.5, 38.30 + (0.1 * Math.random())),
                icon: new TYIcon()
            });
            data.push(p);
        }
        var pointobj = new TYPointOption();
        pointobj.pointData =  data;
        pointobj.pointState.isClearOverlay = true;
        pointobj.pointState.isGather = a;
        pointobj.pointState.isSetView = true;
        //实例化事件参数
        var event = new TYOverlayEvent();
        event.mouseEvent = TYEnumEvent.TY_CLICK;
        event.mouseFunc = clickMarker;
        pointobj.pointState.overlayEvent = event;
        //绘制函数
        TYDrawPoint(pointobj);
    }
    // addpoints();
    addpoints(false);
    $(document).ready(function () {
        $("#cb").change(function () {
            if (this.checked) {
                addpoints(true);
                TYSetLevel(10);
            }
            else
                addpoints(false);
        });
    })

    function clickMarker(e) {
        alert("触发了回调函数");
        console.log(e)
    }

    function add() {
        var tile = new TYTilesOptions(TYEnumMapType.TY_TDT_VEC);//图层入参
        TYMapTiles(tile);
    }
    _map.on("rightclick", function () {
        add()
    })
</script>
</body>
</html>
