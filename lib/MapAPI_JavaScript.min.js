/**
 * v.1.0
 * @author luwenjun 2016年10月31日10:52:45
 */
document.write("\x3cscript src\x3d'/lib/openlayers.js'\x3e\x3c/script\x3e");document.write("\x3clink rel\x3d'stylesheet' href\x3d'/lib/openlayers.css' type\x3d'text/css'\x3e");document.write("\x3cscript src\x3d'/lib/polyfill.min.js'\x3e\x3c/script\x3e");var TYEnumMapType={TY_OL_OSM:15,TY_OL_Land:16,TY_GD_VEC:2,TY_GD_IMG:3,TY_QQ_VEC:4,TY_QQ_IMG:5,TY_QQ_Land:6,TY_360_VEC:7,TY_360_IMG:8,TY_Google_VEC:9,TY_Google_IMG:10,TY_Google_Land:11,TY_TDT_VEC:12,TY_TDT_IMG:13,TY_VEC:14},TYEnumTraffic={TY_TRAFFIC_360:1,TY_TRAFFIC_QQ:2,TY_TRAFFIC_AMAP:3},TYEnumSpAsis={P_PGON:1,LINE_SIS:2,PLOYGON_SIS:3},TYEnumLngLatType={TY_GPS:1,TY_GCJ:2,TY_BD:3};function TYEventOptions(a){a&&(a.event&&(this.event=a.event),a.callback&&(this.callback=a.callback))}var TYEnumMapUrl={TY_GAODE:{ID:1,URL_SL:["http://webrd01.is.autonavi.com/appmaptile?lang\x3dzh_cn\x26size\x3d1\x26scale\x3d1\x26style\x3d7\x26x\x3d{x}\x26y\x3d{y}\x26z\x3d{z}"],URL_WX:["http://webst03.is.autonavi.com/appmaptile?style\x3d6\x26x\x3d{x}\x26y\x3d{y}\x26z\x3d{z}","http://webst04.is.autonavi.com/appmaptile?x\x3d{x}\x26y\x3d{y}\x26z\x3d{z}\x26lang\x3dzh_cn\x26size\x3d1\x26scale\x3d1\x26style\x3d8"]},TY_TIANDITU:{ID:2,URL_SL:["http://t1.tianditu.com/DataServer?T\x3dvec_w\x26x\x3d{x}\x26y\x3d{y}\x26L\x3d{z}","http://t1.tianditu.com/DataServer?T\x3dcva_w\x26X\x3d{x}\x26Y\x3d{y}\x26L\x3d{z}"],URL_WX:["http://t1.tianditu.com/DataServer?T\x3dimg_w\x26x\x3d{x}\x26y\x3d{y}\x26L\x3d{z}","http://t1.tianditu.com/DataServer?T\x3dcia_w\x26X\x3d{x}\x26Y\x3d{y}\x26L\x3d{z}"]},TY_GOOGLE:{ID:3,URL_SL:["http://mt3.google.cn/vt/lyrs\x3dm@142\x26hl\x3dzh-CN\x26gl\x3dcn\x26x\x3d{x}\x26y\x3d{y}\x26z\x3d{z}\x26s\x3dGalil"],URL_WX:["http://mt3.google.cn/vt/lyrs\x3dy@142\x26hl\x3dzh-CN\x26gl\x3dcn\x26x\x3d{x}\x26y\x3d{y}\x26z\x3d{z}\x26s\x3dGalil"],URL_DX:["http://mt3.google.cn/vt/lyrs\x3dp@142\x26hl\x3dzh-CN\x26gl\x3dcn\x26x\x3d{x}\x26y\x3d{y}\x26z\x3d{z}\x26s\x3dGalil"]},TY_360:{ID:4,URL_SL:["http://tile4.ishowchina.com/v3/tile/{z}/{x}/{y}.png"]},TY_TIANYUAN:{ID:5,URL_SL:["http://wd.tygps.com:15050/tyall/wms"]},TY_OL3:{ID:6,URL_SL:["http://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],URL_DX:["https://a.tile.thunderforest.com/cycle/{z}/{x}/{y}.png"]}},TYEnumDrivingPolicy={LEAST_TIME:1,LEAST_MONEY:2,LEAST_DISTANCE:3,REAL_TRAFFIC:4},TYEnumEvent={TY_CLICK:"singleclick",TY_DOUBLECLICK:"dblclick",TY_MOUSEOVER:"pointermove",TY_DRAGSTART:"pointerdrag",TY_DRAGEND:"moveend",TY_ZOOMCHANGE:"",TY_DRAGGING:"pointerdrag"},TYEnumOverLay={TY_POINT:1,TY_POLYLINE:2,TY_CIRCLE:3,TY_POLYGON:4,TY_RECTANGLE:5},TYEnumMassShape={TY_MASS_CUSTOM:1,TY_MASS_CIRCLE:2,TY_MASS_STAR:3,TY_MASS_BULLE:4,TY_MASS_RECT:5},TYEnumMassSize={TY_MASS_SUPERBIG:4,TY_MASS_BIG:3,TY_MASS_MIDDLE:2,TY_MASS_SMALL:1},TYEnumGeocoder={TY_EXACT_DESC:1,TY_NEAR_DESC:2,TY_Road_DESC:3};function TYIcon(a){if(a&&"string"==typeof a)return a;this.url="http://webapi.amap.com/theme/v1.3/markers/n/mark_b.png";this.offset=new TYPixel(0,0);if(a){if(a.url&&(this.url=a.url),a.offset&&(this.offset=a.offset),a.size)return a=Object({image:this.url,size:a.size,imageOffset:this.offset})}else return a=Object({image:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",size:[19,30]})}function TYLabel(a){this.content;this.offset;a&&(a.content&&(this.content=a.content),a.offset&&(this.offset=a.offset))}function TYPixel(a,e){return[a,e]}function TYSize(a,e){return[a,e]}function TYMarker(a){this.icon=this.lnglat=this.label=this.pointId=null;a&&(a.pointId&&(this.pointId=a.pointId),a.label&&(this.label=a.label),a.lnglat&&(this.lnglat=a.lnglat),a.icon&&(this.icon=a.icon))}function TYLine(a){this.lineId=this.lnglat=null;this.lineColor="blue";this.lineWidth=1;this.lineType="solid";this.lineOpacity=.6;this.isEdit=!1;a&&(a.lnglat&&(this.lnglat=a.lnglat),a.pointId&&(this.pointId=a.pointId),a.lineColor&&(this.lineColor=a.lineColor),a.lineWidth&&(this.lineWidth=a.lineWidth),a.lineType&&(this.lineType=a.lineType),a.lineOpacity&&(this.lineOpacity=a.lineOpacity),void 0!=a.isEdit&&(this.isEdit=a.isEdit))}function TYRectangle(a){this.b_l_LngLat=this.t_r_LngLat=this.rectangleId=null;this.lineColor="blue";this.lineWidth=1;this.lineType="solid";this.lineOpacity=.6;this.fillColor="white";this.fillOpacity=.6;this.isEdit=!1;a&&(a.rectangleId&&(this.rectangleId=a.rectangleId),a.t_r_LngLat&&(this.t_r_LngLat=a.t_r_LngLat),a.b_l_LngLat&&(this.b_l_LngLat=a.b_l_LngLat),a.lineColor&&(this.lineColor=a.lineColor),a.lineWidth&&(this.lineWidth=a.lineWidth),a.lineType&&(this.lineType=a.lineType),a.lineOpacity&&(this.lineOpacity=a.lineOpacity),a.fillColor&&(this.fillColor=a.fillColor),a.fillOpacity&&(this.fillOpacity=a.fillOpacity),a.isEdit&&(this.isEdit=a.isEdit))}function TYPolygon(a){this.polygonId=this.lnglat=null;this.lineColor="blue";this.lineWidth=1;this.lineType="solid";this.lineOpacity=.6;this.fillColor="white";this.fillOpacity=.6;this.isEdit=!1;a&&(a.lnglat&&(this.lnglat=a.lnglat),a.polygonId&&(this.polygonId=a.polygonId),a.lineColor&&(this.lineColor=a.lineColor),a.lineWidth&&(this.lineWidth=a.lineWidth),a.lineType&&(this.lineType=a.lineType),a.lineOpacity&&(this.lineOpacity=a.lineOpacity),a.fillColor&&(this.fillColor=a.fillColor),a.fillOpacity&&(this.fillOpacity=a.fillOpacity),void 0!=a.isEdit&&(this.isEdit=a.isEdit))}function TYCircle(a){this.radius=this.circleId=this.lnglat=null;this.lineColor="blue";this.lineWidth=1;this.lineType="solid";this.lineOpacity=.6;this.fillColor="white";this.fillOpacity=.6;this.isEdit=!1;a&&(a.lnglat&&(this.lnglat=a.lnglat),a.circleId&&(this.circleId=a.circleId),a.radius&&(this.radius=a.radius),a.lineColor&&(this.lineColor=a.lineColor),a.lineWidth&&(this.lineWidth=a.lineWidth),a.lineType&&(this.lineType=a.lineType),a.lineOpacity&&(this.lineOpacity=a.lineOpacity),a.fillColor&&(this.fillColor=a.fillColor),a.fillOpacity&&(this.fillOpacity=a.fillOpacity),void 0!=a.isEdit&&(this.isEdit=a.isEdit))}function TYBoundsOption(a){this.b_l_lnglat=this.t_r_lnglat=null;a&&(a.t_r_lnglat&&(this.t_r_lnglat=a.t_r_lnglat),a.b_l_lnglat&&(this.b_l_lnglat=a.b_l_lnglat))}function TYLocusOption(a){this.locusData={locusId:null,label:null,icon:"http://wd.tygps.com:82/tymap/carright.png",lnglat:[],lineType:"solid",lineWidth:3,nodeIcon:null,lineOpacity:.6,lineColor:"#0000ff"};this.locusState={moveSpeed:100,isSetView:!0,syncEvent:null,circlable:!1,overlayEvent:null};a&&a.locusData&&(a.locusData.locusId&&(this.locusData.locusId=a.locusData.locusId),a.locusData.icon&&(this.locusData.icon=a.locusData.icon),a.locusData.label&&(this.locusData.label=a.locusData.label),a.locusData.lnglat&&(this.locusData.lnglat=a.locusData.lnglat),a.locusData.lineType&&(this.locusData.lineType=a.locusData.lineType),a.locusData.nodeIcon&&(this.locusData.nodeIcon=a.locusData.nodeIcon),a.locusData.lineWidth&&(this.locusData.lineWidth=a.locusData.lineWidth),a.locusData.lineColor&&(this.locusData.lineColor=a.locusData.locusData.lineColor),a.locusState&&(a.locusState.moveSpeed&&(this.locusState.moveSpeed=a.locusState.moveSpeed),void 0!=a.locusState.isSetView&&(this.locusState.isSetView=a.locusState.isSetView),a.locusState.syncEvent&&(this.locusState.syncEvent=a.locusState.syncEvent),void 0!=a.locusState.circlable&&(this.locusState.circlable=a.locusState.circlable),a.locusState.overlayEvent&&(this.locusState.overlayEvent=a.locusState.overlayEvent)))}function TYDrivingOptions(a){this.policy=TYEnumDrivingPolicy.LEAST_TIME;this.passWayPoints=[];this.callback=this.panelId=this.destination=this.origin=null;a&&(a.policy&&(this.policy=a.policy),a.passWayPoints&&(this.passWayPoints=a.passWayPoints),a.origin&&(this.origin=a.origin),a.policy&&(this.policy=a.policy),a.destination&&(this.destination=a.destination),a.panelId&&(this.panelId=a.panelId),a.callback&&(this.callback=a.callback))}function TYMapOptions(a){this.lnglat=this.contentId=null;this.mapLevel=12;a&&(a.contentId&&(this.contentId=a.contentId),a.lnglat&&(this.lnglat=a.lnglat),a.mapLevel&&(this.mapLevel=a.mapLevel))}function TYConfigOption(a){this.isScrollWheel=this.isJog=this.isKeyboard=this.isDoubleClickZoom=this.isZoom=this.isDrag=this.isRotate=this.isAnimate=this.isShowSale=this.isShowControl=this.isShowOverView=!0;a&&(void 0!=a.isShowOverView&&(this.isShowOverView=a.isShowOverView),void 0!=a.isShowControl&&(this.isShowControl=a.isShowControl),void 0!=a.isShowSale&&(this.isShowSale=a.isShowSale),void 0!=a.isAnimate&&(this.isAnimate=a.isAnimate),void 0!=a.isRotate&&(this.isRotate=a.isRotate),void 0!=a.isDrag&&(this.isDrag=a.isDrag),void 0!=a.isZoom&&(this.isZoom=a.isZoom),void 0!=a.isDoubleClickZoom&&(this.isDoubleClickZoom=a.isDoubleClickZoom),void 0!=a.isKeyboard&&(this.isKeyboard=a.isKeyboard),void 0!=a.isJog&&(this.isJog=a.isJog),void 0!=a.isScrollWheel&&(this.isScrollWheel=a.isScrollWheel))}function TYTilesOptions(a){this.TYMapType=_ty_layers_id;a&&(this.TYMapType=a)}function TYPointOption(a){this.pointData=[];this.pointState={isSetView:!0,isClearOverlay:!0,isGather:!1,overlayEvent:null};a&&(a.pointData&&(this.pointData=a.pointData),a.pointState&&(void 0!=a.pointState.isSetView&&(this.pointState.isSetView=a.pointState.isSetView),void 0!=a.pointState.isClearOverlay&&(this.pointState.isClearOverlay=a.pointState.isClearOverlay),void 0!=a.pointState.isGather&&(this.pointState.isGather=a.pointState.isGather),a.pointState.overlayEvent&&(this.pointState.overlayEvent=a.pointState.overlayEvent)))}function TYLineOption(a){this.lineData=[];this.lineState={isSetView:!0,isClearOverlay:!0,overlayEvent:null};a&&(a.lineData&&(this.lineData=a.lineData),a.lineState&&(void 0!=a.lineState.isSetView&&(this.lineState.isSetView=a.lineState.isSetView),void 0!=a.lineState.isClearOverlay&&(this.lineState.isClearOverlay=a.lineState.isClearOverlay),a.lineState.overlayEvent&&(this.lineState.overlayEvent=a.lineState.overlayEvent)))}function TYRectangleOption(a){this.rectangleData=[];this.rectangleState={isSetView:!0,isClearOverlay:!0,overlayEvent:null};a&&(a.rectangleData&&(this.rectangleData=a.rectangleData),a.rectangleState&&(void 0!=a.rectangleState.isSetView&&(this.rectangleState.isSetView=a.rectangleState.isSetView),void 0!=a.rectangleState.isClearOverlay&&(this.rectangleState.isClearOverlay=a.rectangleState.isClearOverlay),a.rectangleState.overlayEvent&&(this.rectangleState.overlayEvent=a.rectangleState.overlayEvent)))}function TYPolygonOption(a){this.polygonData=[];this.polygonState={isSetView:!0,isClearOverlay:!0,overlayEvent:null};a&&(a.polygonData&&(this.polygonData=rectangleOption.polygonData),a.polygonState&&(void 0!=a.polygonState.isSetView&&(this.polygonState.isSetView=a.polygonState.isSetView),void 0!=a.polygonState.isClearOverlay&&(this.polygonState.isClearOverlay=a.polygonState.isClearOverlay),a.polygonState.overlayEvent&&(this.polygonState.overlayEvent=a.polygonState.overlayEvent)))}function TYCircleOption(a){this.circleData=[];this.circleState={isSetView:!0,isClearOverlay:!0,overlayEvent:null};a&&(a.circleData&&(this.circleData=a.circleData),a.circleState&&(void 0!=a.circleState.isSetView&&(this.circleState.isSetView=a.circleState.isSetView),void 0!=a.circleState.isClearOverlay&&(this.circleState.isClearOverlay=a.circleState.isClearOverlay),a.circleState.overlayEvent&&(this.circleState.overlayEvent=a.circleState.overlayEvent)))}function TYOverlayOption(a){this.overlayType=null;this.isShowMath=!1;this.callfunc=null;this.isClearOverlay=!1;a&&(a.overlayType&&(this.overlayType=a.overlayType),void 0!=a.isShowMath&&(this.isShowMath=a.isShowMath),a.callfunc&&(this.callfunc=a.callfunc),void 0!=a.isClearOverlay&&(this.isClearOverlay=a.isClearOverlay))}function TYInfoWindowOptions(a){this.width=300;this.height=200;this.offset=new TYPixel(0,0);this.position=this.content=null;this.enableCloseOnClick=this.isCustom=this.showShadow=!1;a&&(a.width&&(this.width=a.width),a.height&&(this.height=a.height),a.offset&&(this.offset=a.offset),a.content&&(this.content=a.content),a.position&&(this.position=a.position),void 0!=a.showShadow&&(this.showShadow=a.showShadow),void 0!=a.isCustom&&(this.isCustom=a.isCustom),void 0!=a.enableCloseOnClick&&(this.enableCloseOnClick=a.enableCloseOnClick))}function TYDistrictSearchOptions(a){this.code=null;this.lineColor="#00ff00";this.lineOpacity=this.lineWidth=1;this.fillColor="#ffffff";this.fillOpacity=1;this.isClearOverlay=this.isDrawArea=!0;this.callback=null;a&&(a.code&&(this.code=a.code),a.lineColor&&(this.lineColor=a.lineColor),a.lineWidth&&(this.lineWidth=a.lineWidth),void 0!=a.isClearOverlay&&(this.isClearOverlay=a.isClearOverlay),a.lineOpacity&&(this.lineOpacity=a.lineOpacity),a.fillColor&&(this.fillColor=a.fillColor),a.fillOpacity&&(this.fillOpacity=a.fillOpacity),void 0!=a.isDrawArea&&(this.isDrawArea=a.isDrawArea),a.callback&&(this.callback=a.callback))}function TYPanoramaOption(a){this.containerId;this.position;a&&(a.containerId&&(this.containerId=a.containerId),a.position&&(this.position=a.position))}function renderData(a){this.icon=this.label=this.lnglat=this.renderId=null;this.borderColor="0000ff";this.borderWidth=2;this.fillColor="ffffff";a&&(a.renderId&&(this.renderId=a.renderId),a.icon&&(this.icon=a.icon),a.lnglat&&(this.lnglat=a.lnglat),a.borderWidth&&(this.borderWidth=a.borderWidth),a.label&&(this.label=a.label),a.borderColor&&(this.borderColor=a.borderColor.trim("#")),a.fillColor&&(this.fillColor=a.fillColor.trim("#")))}function TYAreaRenderOption(a){this.renderDatas=[];a&&a.renderDatas&&(this.renderDatas=a.renderDatas);this.renderState={tileOpacity:.4,isClearOverlay:!0,isSetView:!0,overlayEvent:null};a&&a.renderState&&(this.renderState.tileOpacity&&(this.renderState.tileOpacity=a.renderState.tileOpacity),void 0!=this.renderState.isClearOverlay&&(this.renderState.isClearOverlay=a.renderState.isClearOverlay),void 0!=this.renderState.isSetView&&(this.renderState.isSetView=a.renderState.isSetView),this.renderState.overlayEvent&&(this.renderState.overlayEvent=a.renderState.overlayEvent))}function TYConvertOptions(a){this.lnglats=null;this.oType=TYEnumLngLatType.TY_GPS;this.tType=TYEnumLngLatType.TY_GCJ;a&&(a.lnglats&&(this.lnglats=a.lnglats),a.oType&&(this.otype=a.oType),a.tType&&(this.lnglats=a.tType))}function TYWeatherOptions(a){this.callback=this.district=null;a&&(a.district&&(this.district=a.district),a.callback&&(this.callback=a.callback))}function TYGeolocationOptions(a){this.showButton=!0;this.buttonPosition="LB";this.buttonOffset=[10,20];this.zoomToAccuracy=this.panToLocation=this.showCircle=this.showMarker=!0;this.callback=null;a&&(a.showButton&&(this.showButton=a.showButton),a.buttonOffset&&(this.buttonOffset=a.buttonOffset),a.buttonPosition&&(this.buttonPosition=a.buttonPosition),void 0!=a.showMarker&&(this.showMarker=a.showMarker),void 0!=a.showCircle&&(this.showCircle=a.showCircle),void 0!=a.panToLocation&&(this.panToLocation=a.panToLocation),void 0!=a.zoomToAccuracy&&(this.zoomToAccuracy=a.zoomToAccuracy),a.callback&&(this.callback=a.callback))}function TYSpasisOptions(a){this.polyGon=this.polyLine=this.point=this.sisType=null;a&&(a.sisType&&(this.sisType=a.sisType),a.point&&(this.point=a.point),a.polyLine&&(this.polyLine=a.polyLine),a.polyGon&&(this.polyGon=a.polyGon))}function TYGetLocationOptions(a){this.callback=this.address=null;a&&(a.address&&(this.address=a.address),a.callback&&(this.callback=a.callback))}function TYGeoCoderOptions(a){this.batch=!1;this.callback=this.type=this.location=null;a&&(void 0!=a.batch&&(this.batch=a.batch),a.location&&(this.location=a.location),a.type&&(this.type=a.type),a.callback&&(this.callback=a.callback))}function MassPoint(a){this.lat=this.lng=this.id=null;this.color="#00ff00";this.type=TYEnumMassShape.TY_MASS_STAR;this.size=TYEnumMassSize.TY_MASS_MIDDLE;this.url="http://webapi.amap.com/theme/v1.3/markers/n/mark_b.png";this.opacity=1;a&&(a.id&&(this.id=a.id),a.lng&&(this.lng=a.lng),a.lat&&(this.lat=a.lat),a.color&&(this.color=a.color),a.type&&(this.type=a.type),a.size&&(this.size=a.size),a.url&&(this.url=a.url),a.opacity&&(this.opacity=a.opacity))}function TYMassPointOption(a){this.massPointDatas=[];this.massPointState={isClearOverlay:!0,isSetView:!0,overlayEvent:null};a&&(a.massPointDatas&&(this.massPointDatas=a.massPointDatas),a.massPointState&&(void 0!=a.massPointState.isClearOverlay&&(this.massPointState.isClearOverlay=a.massPointState.isClearOverlay),void 0!=a.massPointState.isSetView&&(this.massPointState.isSetView=a.massPointState.isSetView),a.massPointState.overlayEvent&&(this.massPointState.overlayEvent=a.massPointState.overlayEvent)))}function TYHeatMapOption(a){this.heatMapData={radius:30,gradient:{"0.4":"rgb(0, 255, 255)","0.65":"rgb(0, 110, 255)","0.85":"rgb(100, 0, 255)",1:"rgb(100, 0, 255)"},opacity:[0,1],zooms:[3,19],max:null,DataSet:{}};this.heatMapState={isClearOverlay:!0};a&&(a.heatMapData&&(a.heatMapData.radius&&(this.heatMapData.radius=a.heatMapData.radius),a.heatMapData.gradient&&(this.heatMapData.gradient=a.heatMapData.gradient),a.heatMapData.opacity&&(this.heatMapData.opacity=a.heatMapData.opacity),a.heatMapData.zooms&&(this.heatMapData.zooms=a.heatMapData.zooms),a.heatMapData.max&&(this.heatMapData.max=a.heatMapData.max),a.heatMapData.DataSet&&(this.heatMapData.DataSet=a.heatMapData.DataSet)),a.heatMapState&&void 0!=a.massPointState.isClearOverlay&&(this.massPointState.isClearOverlay=a.massPointState.isClearOverlay))}var _map,_ty_layers_id=15,_ty_source=[],_ty_views,__ty_interaction=[],_ty_view,_ty_tool=[],_ty_scale,_ty_rotate=[],_ty_drag,_ty_zoom=[],_ty_doubleClickZoom,_ty_keyboard=[],_ty_scrollwhell,_ty_copy="\x3cspan style\x3d\"font-family:Helvetica, 'Hiragino Sans GB','Microsoft Yahei', '\u5fae\u8f6f\u96c5\u9ed1', Arial;\"\x3e\x26nbsp;\x3cspan style\x3d\"font-size: 12px;color:#333333\"\x3e\x26copy; thiee.com  \x3c/span\x3e\x3c/span\x3e";document.write("\x3cstyle\x3e.ol-scale-line {position: absolute;bottom: 10px;left: 180px;\x3c/style\x3e");document.write("\x3cstyle\x3e.ol-zoom{position: absolute;top: 6px;left: 6px;}\x3c/style\x3e");document.write("\x3cstyle\x3e.ol-rotate{position:absolute; top:35px;right:6px}\x3c/style\x3e");document.write("\x3cstyle\x3e.ol-ding-wei {position: absolute;bottom: 200px;left: 20px;\x3c/style\x3e");var TYInitialize=function(a){if(a){a.contentId||console.log("\u5730\u56fe\u5bb9\u5668\u7f3a\u5931");a.lnglat||(a.lnglat=ol.proj.fromLonLat([105.34,34.91]),a.mapLevel=5);var e=document.createElement("a");e.href="";e.style.width="32px";e.style.height="31px";e.style.backgroundImage="url('http://tytest.tygps.com/MapDemo/Images/logo.png')";var b=[],c,d=url_para(),g;for(g in d){0==g&&(c=new ol.Attribution({html:_ty_copy}));var h=new ol.layer.Tile({source:new ol.source.XYZ({attributions:[c],url:d[g]})});b.push(h)}c=new ol.interaction.DragAndDrop({formatConstructors:[ol.format.GPX,ol.format.GeoJSON,ol.format.IGC,ol.format.KML,ol.format.TopoJSON]});var f={Point:new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,255,0,0.5)"}),radius:5,stroke:new ol.style.Stroke({color:"#ff0",width:1})})}),LineString:new ol.style.Style({stroke:new ol.style.Stroke({color:"#f00",width:3})}),Polygon:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0,255,255,0.5)"}),stroke:new ol.style.Stroke({color:"#0ff",width:1})}),MultiPoint:new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:"rgba(255,0,255,0.5)"}),radius:5,stroke:new ol.style.Stroke({color:"#f0f",width:1})})}),MultiLineString:new ol.style.Style({stroke:new ol.style.Stroke({color:"#0f0",width:3})}),MultiPolygon:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(0,0,255,0.5)"}),stroke:new ol.style.Stroke({color:"#00f",width:1})})},l=function(a,b){var d=a.getStyleFunction();return d?d.call(a,b):f[a.getGeometry().getType()]};c.on("addfeatures",function(a){a=new ol.source.Vector({features:a.features});_map.addLayer(new ol.layer.Image({source:new ol.source.ImageVector({source:a,style:l})}));_map.getView().fit(a.getExtent(),_map.getSize())});c=ol.interaction.defaults({keyboard:!1}).extend([new ol.interaction.DragRotateAndZoom,c]);_ty_views=new ol.View({minZoom:3,maxZoom:28,center:a.lnglat,zoom:a.mapLevel});_ty_source=b;_map=new ol.Map({renderer:"canvas",loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0,logo:e,layers:_ty_source,interactions:c,controls:ol.control.defaults({zoom:!1}).extend([new ol.control.Attribution({tipLabel:"\u7248\u6743\u4fe1\u606f",label:"\u00ab",collapseLabel:"\u00bb"}),new ol.control.FullScreen({tipLabel:"\u5168\u5c4f\u6d4f\u89c8"})]),target:a.contentId,view:_ty_views})}},TYMapConfig=function(a){void 0==_ty_view&&(_ty_view=new ol.control.OverviewMap({collapseLabel:"\u25e3",label:"\u25e5",tipLabel:"\u9690\u85cf/\u663e\u793a",collapsed:!1}));0==_ty_tool.length&&(_ty_tool.push(new ol.control.ZoomSlider),_ty_tool.push(new ol.control.Zoom({zoomInTipLabel:"\u653e\u5927",zoomOutTipLabel:"\u7f29\u5c0f"})));void 0==_ty_scale&&(_ty_scale=new ol.control.ScaleLine);0==_ty_rotate.length&&(_ty_rotate.push(new ol.interaction.PinchRotate),_ty_rotate.push(new ol.interaction.DragRotate({})));void 0==_ty_scrollwhell&&(_ty_scrollwhell=new ol.interaction.MouseWheelZoom);void 0==_ty_doubleClickZoom&&(_ty_doubleClickZoom=new ol.interaction.DoubleClickZoom);void 0==_ty_drag&&(_ty_drag=new ol.interaction.DragPan);0==_ty_zoom.length&&(_ty_zoom.push(new ol.interaction.PinchZoom),_ty_zoom.push(new ol.interaction.DragZoom));0==_ty_keyboard.length&&(_ty_keyboard.push(new ol.interaction.KeyboardPan),_ty_keyboard.push(new ol.interaction.KeyboardZoom));if(a){a.isShowOverView?_map.addControl(_ty_view):_map.removeControl(_ty_view);a.isShowControl?(_map.addControl(_ty_tool[0]),_map.addControl(_ty_tool[1])):(_map.removeControl(_ty_tool[0]),_map.removeControl(_ty_tool[1]));a.isShowSale?_map.addControl(_ty_scale):_map.removeControl(_ty_scale);if(a.isRotate)for(var e in _ty_rotate)_map.addInteraction(_ty_rotate[e]);else for(e in _ty_rotate)_map.removeControl(_ty_rotate[e]);a.isDrag?_map.addInteraction(_ty_drag):_map.removeControl(_ty_drag);a.isZoom&&a.isDoubleClickZoom?_map.addInteraction(_ty_doubleClickZoom):a.isDoubleClickZoom?_map.addInteraction(_ty_doubleClickZoom):_map.removeInteraction(_ty_doubleClickZoom);a.isZoom&&a.isScrollWheel?_map.addInteraction(_ty_scrollwhell):a.isScrollWheel?_map.addInteraction(_ty_scrollwhell):_map.removeInteraction(_ty_scrollwhell);if(a.isZoom){if(0<_ty_zoom.length)for(e in _ty_zoom)_map.addInteraction(_ty_zoom[e])}else if(0<_ty_zoom.length)for(e in _ty_zoom)_map.removeInteraction(_ty_zoom[e]);if(a.isKeyboard){if(0<_ty_keyboard.length)for(e in _ty_keyboard)_map.addInteraction(_ty_keyboard[e])}else if(0<_ty_keyboard.length)for(e in _ty_keyboard)_map.removeInteraction(_ty_keyboard[e])}else{_map.addControl(_ty_view);_map.addControl(_ty_tool[0]);_map.addControl(_ty_tool[1]);_map.addControl(_ty_scale);if(0<_ty_rotate.length)for(e in _ty_rotate)_map.addInteraction(_ty_rotate[e]);_map.addInteraction(_ty_scrollwhell);_map.addInteraction(_ty_doubleClickZoom);_map.addInteraction(_ty_drag);if(0<_ty_keyboard.length)for(e in _ty_keyboard)_map.addInteraction(_ty_keyboard[e]);if(0<_ty_zoom.length)for(e in _ty_zoom)_map.addInteraction(_ty_zoom[e])}},TYSetCenter=function(a){if(a)try{_ty_views.setCenter(a)}catch(e){console.log(e.message)}};function elastic(a){return Math.pow(2,-10*a)*Math.sin(2*(a-.075)*Math.PI/.3)+1}var TYSetLevel=function(a){if(a&&0<a)try{_map.getView().setZoom(a)}catch(e){console.log(e.message)}},TYSetBounds=function(a){if(a)try{var e=ol.extent.boundingExtent([[a.t_r_lnglat[0],a.t_r_lnglat[1]],[a.b_l_lnglat[0],a.b_l_lnglat[1]]]);_map.getView().fit(e,_map.getSize())}catch(b){console.log(b.message)}},_ty_onKey,TYSetLimitBounds=function(a){var e=[],b=[];if(a)try{e.push(a.t_r_lnglat[0]),e.push(a.b_l_lnglat[0]),b.push(a.t_r_lnglat[1]),b.push(a.b_l_lnglat[1]),_ty_box(e,b),_ty_moveEnd(_map.getView().getCenter(),_map.getView().getZoom())}catch(c){console.log(c.message)}};function _ty_moveEnd(a,e){a&&e&&(_ty_onKey=_map.on("moveend",function(b){b=b.map;if(b.getView().getCenter()!=a||e!=b.getView().getZoom())_map.getView().setCenter(a),_map.getView().setZoom(e)}),_ty_point.push(_ty_onKey))}var TYBoundsClear=function(){_ty_onKey&&_map.unByKey(_ty_onKey)},_ty_cluster=[],_ty_point=[],_ty_popup=[],_ty_overlays=[],TYDrawPoint=function(a,e){_map.on("pointermove",function(a){a=_map.getEventPixel(a.originalEvent);a=_map.hasFeatureAtPixel(a);_map.getTargetElement().style.cursor=a?"pointer":""});if(a){a.pointData||console.log("\u53c2\u6570\u7f3a\u5931");a.pointState.isClearOverlay&&TYClear();if(!e){var b=[];b.push("point");b.push(a);_ty_overlays.push(b)}var c=[],d=[];void 0==a.pointData.length?d.push(a.pointData):d=a.pointData;var b=[],g=[],h;for(h in d){var f,l,k,n;f=d[h].label?d[h].label.content?d[h].label.content:"":"";d[h].icon.image&&(l=d[h].icon.image);k=d[h].icon.size?d[h].icon.size:[19,31];n=d[h].label?d[h].label.offset?d[h].label.offset:[0,0]:[0,0];var p=new ol.style.Style({image:new ol.style.Icon({opacity:1,src:l,anchor:[.5,1],size:k})}),m=new ol.geom.Point(d[h].lnglat),m=new ol.Feature({geometry:m});m.setId(d[h].pointId);m.kid=h;m.label=d[h].label;m.icon=d[h].icon;m.setStyle(p);c.push(m);p=document.createElement("div");p.innerHTML=f;f=new ol.Overlay({id:"_ty_lj_key_bs_2017_"+h,stopEvent:!1,positioning:"top-left",offset:[n[0]-k[0]/2,n[1]-k[1]],element:p});f.setPosition(d[h].lnglat);_map.addOverlay(f);_ty_popup.push(f);b.push(d[h].lnglat[0]);g.push(d[h].lnglat[1])}if(a.pointState.overlayEvent){var r=function(b){var d={},c=b.getGeometry().getCoordinates();d.GPSLngLat=new GPSLngLat(c[0],c[1]);d.pointId=b.getId();d.label=b.label;d.icon=b.icon;a.pointState.overlayEvent.mouseFunc(d)};h=_map.on(a.pointState.overlayEvent.mouseEvent,function(a){if(a=_map.forEachFeatureAtPixel(a.pixel,function(a){return a}))if(a.get("features"))if(1==a.get("features").length)r(a.get("features")[0]);else{if(1<a.get("features").length){var b=_map.getView().getZoom();if(3<=b&&18>b){var d,c,e,g,f;for(f in a.get("features"))if(1<f){c=a.get("features")[f-1].getGeometry().getCoordinates();var h=a.get("features")[f].getGeometry().getCoordinates();c[0]>=h[0]&&(e=c[0]);d=h[0];c[1]>=h[1]&&(g=c[1]);c=h[1]}_map.getView().getCenter([(e-d)/2+d,(g-c)/2+c]);_map.getView().setZoom(b+1)}}}else r(a)});_ty_point.push(h)}c=new ol.source.Vector({features:c});1==a.pointState.isGather&&(c=new ol.source.Cluster({distance:50,source:c}));var v={},c=new ol.layer.Vector({zIndex:5E4,updateWhileAnimating:!0,updateWhileInteracting:!0,source:c,style:function(b){if(1==a.pointState.isGather){var d=b.get("features").length,c=v[d],e;for(e in b.get("features")){var g,f;if(1>=d){g=b.get("features")[e].getStyle().getImage().getSrc();f=b.get("features")[e].getStyle().getImage().getSize();for(var h in _ty_popup)_ty_popup[h].getElement().style.display="block"}else for(h in 1<d&&10>d?(g="http://webapi.amap.com/theme/v1.3/m1.png",f=[53,53]):10<=d&&99>=d?(g="http://webapi.amap.com/theme/v1.3/m2.png",f=[56,56]):100<=d&&(g="http://webapi.amap.com/theme/v1.3/m3.png",f=[66,66]),_ty_popup)_ty_popup[h].getId()=="_ty_lj_key_bs_2017_"+b.get("features")[e].kid&&(_ty_popup[h].getElement().style.display="none");c=1>=d?new ol.style.Style({image:new ol.style.Icon({anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:1,src:g,anchorOrigin:"top-left",size:f})}):new ol.style.Style({image:new ol.style.Icon({anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:1,src:g,anchorOrigin:"top-left",size:f}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:d.toString(),fill:new ol.style.Fill({color:"#000"}),offsetX:0,offsetY:0,stroke:new ol.style.Stroke({color:"#fff",width:2}),textAlign:"center"})});v[d]=c}return c}}});_map.addLayer(c);_ty_cluster.push(c);a.pointState.isSetView&&_ty_box(b,g)}},TYDrawLine=function(a,e){if(a){a.lineData||console.log("\u53c2\u6570\u7f3a\u5931");a.lineState.isClearOverlay&&TYClear();if(!e){var b=[];b.push("line");b.push(a);_ty_overlays.push(b)}var c=[];a.lineData.length?c=a.lineData:c.push(a.lineData);var d=[],g=[0,0],b=[],h=[],f=[],l;for(l in c){"solid"!=c[l].lineType&&(g=[3,5]);var k=new ol.style.Style({stroke:new ol.style.Stroke({width:c[l].lineWidth,lineDash:g,color:c[l].lineColor})});0==l&&f.push(k);var n=new ol.Feature(new ol.geom.LineString(c[l].lnglat));n.setId(c[l].lineId);n.setStyle(k);d.push(n);var k=c[l].lnglat,p;for(p in k)b.push(k[p][0]),h.push(k[p][1])}a.lineState.overlayEvent&&(l=_map.on(a.lineState.overlayEvent.mouseEvent,function(b){var d=_map.forEachFeatureAtPixel(b.pixel,function(a){return a});if(d){b={};b.lineId=d.getId();var d=d.getGeometry().getCoordinates(),c=[],e;for(e in d)c.push(new GPSLngLat(d[e][0],d[e][1]));b.lnglat=c;a.lineState.overlayEvent.mouseFunc(b)}}),_ty_point.push(l));d=new ol.layer.Vector({zIndex:5E4,source:new ol.source.Vector({features:d})});l=new ol.interaction.Select({style:f});f=new ol.interaction.Modify({features:l.getFeatures(),style:f});_map.addInteraction(l);_map.addInteraction(f);__ty_interaction&&(__ty_interaction.push(l),__ty_interaction.push(f));_map.addLayer(d);_ty_cluster.push(d);a.lineState.isSetView&&_ty_box(b,h)}},TYDrawRectangle=function(a,e){if(a){a.rectangleData||console.log("\u53c2\u6570\u7f3a\u5931");a.rectangleState.isClearOverlay&&TYClear();if(!e){var b=[];b.push("rect");b.push(a);_ty_overlays.push(b)}var c=[];a.rectangleData.length?c=a.rectangleData:c.push(a.rectangleData);var d=[],g=[0,0],b=[],h=[],f;for(f in c){"solid"!=c[f].lineType&&(g=[3,5]);var l=new ol.style.Style({stroke:new ol.style.Stroke({width:c[f].lineWidth,lineDash:g,color:c[f].lineColor}),fill:new ol.style.Fill({color:[255,255,255,.7]})}),k,n;k=c[f].t_r_LngLat;n=c[f].b_l_LngLat;var p=new ol.Feature(new ol.geom.Polygon([[k,[n[0],k[1]],n,[k[0],n[1]],k]]));p.setId(c[f].rectangleId);p.setStyle(l);d.push(p);l=[];l.push(k);l.push(n);for(var m in l)b.push(l[m][0]),h.push(l[m][1])}a.rectangleState.overlayEvent&&(f=_map.on(a.rectangleState.overlayEvent.mouseEvent,function(b){var d=_map.forEachFeatureAtPixel(b.pixel,function(a){return a});if(d){b={};b.rectangleId=d.getId();var d=d.getGeometry().getCoordinates(),c=[],e;for(e in d[0])c.push(new GPSLngLat(d[0][e][0],d[0][e][1]));b.GPSLngLat=c;a.rectangleState.overlayEvent.mouseFunc(b)}}),_ty_point.push(f));d=new ol.layer.Vector({zIndex:5E4,source:new ol.source.Vector({features:d})});f=new ol.interaction.Select;m=new ol.interaction.Modify({features:f.getFeatures()});c=new ol.interaction.Translate({features:f.getFeatures()});_map.addInteraction(f);_map.addInteraction(c);_map.addInteraction(m);__ty_interaction&&(__ty_interaction.push(f),__ty_interaction.push(c),__ty_interaction.push(m));_map.addLayer(d);_ty_cluster.push(d);a.rectangleState.isSetView&&_ty_box(b,h)}},TYDrawPolygon=function(a,e){if(a){a.polygonData||console.log("\u53c2\u6570\u7f3a\u5931");a.polygonState.isClearOverlay&&TYClear();if(!e){var b=[];b.push("polygon");b.push(a);_ty_overlays.push(b)}var c=[];a.polygonData.length?c=a.polygonData:c.push(a.polygonData);var d=[],g=[0,0],b=[],h=[],f;for(f in c){"solid"!=c[f].lineType&&(g=[3,5]);var l=new ol.style.Style({stroke:new ol.style.Stroke({width:c[f].lineWidth,lineDash:g,color:c[f].lineColor}),fill:new ol.style.Fill({color:[255,255,255,.7]})}),k=new ol.Feature(new ol.geom.Polygon([c[f].lnglat]));k.setId(c[f].polygonId);k.setStyle(l);d.push(k);var l=c[f].lnglat,n;for(n in l)b.push(l[n][0]),h.push(l[n][1])}a.polygonState.overlayEvent&&(f=_map.on(a.polygonState.overlayEvent.mouseEvent,function(b){var d=_map.forEachFeatureAtPixel(b.pixel,function(a){return a});if(d){b={};b.polygonId=d.getId();var c=d.getGeometry().getCoordinates();console.log(d);var d=[],e;for(e in c[0])d.push(new GPSLngLat(c[0][e][0],c[0][e][1]));b.GPSLngLat=d;a.polygonState.overlayEvent.mouseFunc(b)}}),_ty_point.push(f));d=new ol.layer.Vector({zIndex:5E4,source:new ol.source.Vector({features:d})});f=new ol.interaction.Select;n=new ol.interaction.Modify({features:f.getFeatures()});c=new ol.interaction.Translate({features:f.getFeatures()});_map.addInteraction(f);_map.addInteraction(c);_map.addInteraction(n);__ty_interaction&&(__ty_interaction.push(f),__ty_interaction.push(c),__ty_interaction.push(n));_map.addLayer(d);_ty_cluster.push(d);a.polygonState.isSetView&&_ty_box(b,h)}},TYDrawCircle=function(a,e){if(a){a.circleData||console.log("\u53c2\u6570\u7f3a\u5931");a.circleState.isClearOverlay&&TYClear();if(!e){var b=[];b.push("circle");b.push(a);_ty_overlays.push(b)}var c=[];a.circleData.length?c=a.circleData:c.push(a.circleData);var d=[],g=[0,0],b=[],h=[],f;for(f in c){"solid"!=c[f].lineType&&(g=[3,5]);var l=new ol.style.Style({stroke:new ol.style.Stroke({width:c[f].lineWidth,lineDash:g,color:c[f].lineColor}),fill:new ol.style.Fill({color:[255,255,255,.7]})}),k=new ol.Feature(new ol.geom.Circle(c[f].lnglat,c[f].radius));k.setId(c[f].circleId);k.setStyle(l);d.push(k);new ol.Feature({geometry:new ol.geom.Point(c[f].lnglat)});new ol.style.Style({image:new ol.style.Circle({radius:2,stroke:new ol.style.Stroke({color:RGBA("#ffffff",1),width:3}),fill:new ol.style.Fill({color:RGBA("#FF4500",.9)})})});l=c[f].lnglat;b.push(l[0]);h.push(l[1])}a.circleState.overlayEvent&&(f=_map.on(a.circleState.overlayEvent.mouseEvent,function(b){if(b=_map.forEachFeatureAtPixel(b.pixel,function(a){return a})){var d={},c=b.getGeometry().getCenter();d.GPSLngLat=new GPSLngLat(c[0],c[1]);d.radius=b.getGeometry().getRadius();d.circleId=b.getId();a.circleState.overlayEvent.mouseFunc(d)}}),_ty_point.push(f));d=new ol.layer.Vector({zIndex:5E4,source:new ol.source.Vector({features:d})});f=new ol.interaction.Select;c=new ol.interaction.Translate({features:f.getFeatures()});_map.addInteraction(f);_map.addInteraction(c);__ty_interaction&&(__ty_interaction.push(f),__ty_interaction.push(c));_map.addLayer(d);_ty_cluster.push(d);a.circleState.isSetView&&_ty_box(b,h)}},_ty_draw_vector=[],_ty_draw_end,_ty_draw,TYDrawOverlay=function(a){if(a){a.isClearOverlay?TYClear():TYClear(!1);var e=new ol.source.Vector({wrapX:!1}),b=new ol.layer.Vector({zIndex:5E4,source:e,style:function(b){b=b.getGeometry();var d;switch(b.getType()){case "Point":var c=GPSLngLat(b.getCoordinates()[0],b.getCoordinates()[1]);d="\u7ecf\u5ea6:"+c.GPSLng;d+="\r\n\u7eac\u5ea6:"+c.GPSLat;break;case "LineString":c=b.getCoordinates();d="\u957f:"+formatLength(c)+" m";break;case "Circle":c=GPSLngLat(b.getCenter()[0],b.getCenter()[1]);d="\u7ecf\u5ea6:"+c.GPSLng;d+="\r\n\u7eac\u5ea6:"+c.GPSLat;d+="\r\n\u534a\u5f84:"+formatLength([b.getFirstCoordinate(),b.getLastCoordinate()])+" m";break;case "Polygon":c=b.getCoordinates()[0];d="\u9762\u79ef:"+formataArea(c)+" \u33a1";break;case "Square":c=b.getCoordinates()[0],d="\u9762\u79ef:"+formataArea(c)+" \u33a1"}return new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.7)"}),stroke:new ol.style.Stroke({color:"rgba(255, 0, 0, 0.7)",width:3}),image:new ol.style.Icon({opacity:1,src:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",imgSize:[19,31],anchor:[.5,1]}),text:new ol.style.Text({font:"12px Microsoft Yahei",text:1==a.isShowMath?d:"",fill:new ol.style.Fill({color:"red"}),stroke:new ol.style.Stroke({color:"#fff",width:3}),offsetY:15,textAlign:"center"})})}});_map.addLayer(b);_ty_draw_vector.push(b);(function(){var b;a.overlayType&&(1==a.overlayType&&(b="Point"),2==a.overlayType&&(b="LineString"),3==a.overlayType&&(b="Circle"),4==a.overlayType&&(b="Polygon"),5==a.overlayType&&(b="Square"));if(b){var c,h;"Square"===b&&(b="LineString",h=2,c=function(a,b){b||(b=new ol.geom.Polygon(null));var d=a[0],c=a[1];b.setCoordinates([[d,[d[0],c[1]],c,[c[0],d[1]],d]]);return b});_ty_draw=new ol.interaction.Draw({source:e,type:b,geometryFunction:c,maxPoints:h});_map.addInteraction(_ty_draw)}})();if(_ty_point)for(var c in _ty_point)_map.removeInteraction(_ty_point[0]);a.callfunc&&(_ty_draw_end=_ty_draw.on("drawend",function(b){var c=b.feature.getGeometry();b={};switch(c.getType()){case "Point":var d=GPSLngLat(c.getCoordinates()[0],c.getCoordinates()[1]);b={};b.GPSLngLat=d;break;case "LineString":var d=c.getCoordinates(),c=[],e;for(e in d)c.push(GPSLngLat(d[e][0],d[e][1]));b={};b.GPSLngLat=c;b.length=formatLength(d);break;case "Circle":d=GPSLngLat(c.getCenter()[0],c.getCenter()[1]);b.GPSLngLat=d;b.radius=formatLength([c.getFirstCoordinate(),c.getLastCoordinate()]);b.area=Math.pow(b.radius,2)*Math.PI;break;case "Polygon":d=c.getCoordinates()[0];c=[];for(e in d)c.push(GPSLngLat(d[e][0],d[e][1]));b={};b.GPSLngLat=c;b.area=formataArea(d);break;case "Square":d=c.getCoordinates()[0];c=[];for(e in d)c.push(GPSLngLat(d[e][0],d[e][1]));b={};b.GPSLngLat=c;b.area=formataArea(d)}a.callfunc(b)}),_ty_point.push(_ty_draw_end))}},TYDrawStop=function(a){_ty_draw&&_map.removeInteraction(_ty_draw);if(a&&_ty_draw_vector)for(var e in _ty_draw_vector)_map.removeLayer(_ty_draw_vector[e])},TYSetFitView=function(){if(_ty_cluster){var a=_ty_cluster[0].getSource().getFeatures();if(0<a.length){var e=[],b=[],c;for(c in a)e.push(a[c].getGeometry().getExtent()[0]),e.push(a[c].getGeometry().getExtent()[2]),b.push(a[c].getGeometry().getExtent()[1]),b.push(a[c].getGeometry().getExtent()[3]);a=[e.sort()[0],b.sort()[0],e.sort()[e.sort().length-1],b.sort()[e.sort().length-1]];_map.getView().fit(a,_map.getSize())}}};document.write("\x3cstyle\x3e.ol-popup{position: absolute;background-color: white;-webkit-filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));");document.write("filter: drop-shadow(0 1px 4px rgba(0,0,0,0.2));padding: 15px;border-radius: 10px;border: 1px solid #cccccc;bottom: 12px;left: -50px;min-width: 280px;}\x3c/style\x3e");document.write("\x3cstyle\x3e.ol-popup:after, .ol-popup:before {top: 100%;border: solid transparent;content: ' ';height: 0;width: 0;position: absolute;pointer-events: none;}\x3c/style\x3e");document.write("\x3cstyle\x3e.ol-popup:after {border-top-color: white;border-width: 10px;left: 48px;margin-left: -10px;}\x3c/style\x3e");document.write("\x3cstyle\x3e.ol-popup:before {border-top-color: #cccccc;border-width: 11px;left: 48px;margin-left: -11px;}\x3c/style\x3e");document.write("\x3cstyle\x3e.ol-popup-closer {text-decoration: none;position: absolute;top: 2px;right: 8px;}\x3c/style\x3e");document.write("\x3cstyle\x3e.ol-popup-closer:after {content: '\u2716';}\x3c/style\x3e");var __ty_closer,__ty_overlay,__ty_closeinfo,_ty_infoWindow,TYInfoWindow=function(a){if(a){a.position||console.log("\u5f39\u51fa\u6846\u53c2\u6570\u7f3a\u5931");__ty_overlay&&__ty_overlay.setPosition(void 0);__ty_closer&&(__ty_closer.click(),__ty_closer.blur());var e,b,c,d;e=a.isCustom;b=a.enableCloseOnClick;a.offset&&(c=a.offset);a.content&&(d=a.content);if(e)e=document.createElement("div"),e.id="zdy"+Math.random(),e.innerHTML=d,d=e,c=[c[0]-3,c[1]-20];else{e=document.createElement("div");e.className="ol-popup";var g=document.createElement("div");g.id="popup-content"+Math.random();var h=document.createElement("a");h.className="ol-popup-closer";h.onclick=function(){TYInfoWindowClose();return!1};e.appendChild(h);e.appendChild(g);__ty_closer=h;e.style.width=a.width+"px";e.style.height=a.height+"px";g.innerHTML=d;d=e}c=new ol.Overlay({element:d,autoPan:!0,offset:c,positioning:"top-left"});_map.addOverlay(c);__ty_overlay=c;c.setPosition(a.position);b&&(__ty_closeinfo=_map.on("click",function(a){TYInfoWindowClose()}))}},TYInfoWindowClose=function(){__ty_overlay&&__ty_overlay.setPosition(void 0);__ty_closeinfo&&_map.unByKey(__ty_closeinfo);__ty_closer&&(__ty_closer.click(),__ty_closer.blur())},TYAddMapEvent=function(a){if(_map){var e=_map.on("click",function(b){b={location:new GPSLngLat(b.coordinate[0],b.coordinate[1])};a.callback&&a.callback(b)});_ty_point.push(e)}},TYPanorama=function(a){try{var e=a.containerId,b=a.position,c=ol.proj.toLonLat([b[0],b[1]]);TYShowQQOpenStreetView(c[0],c[1],c[0],c[1],e)}catch(d){console.log(d.message)}};document.write("\x3cscript type\x3d'text/javascript' src\x3d'http://map.qq.com/api/js?v\x3d2.exp\x26key\x3dCBYBZ-BVHHX-LLQ4A-7VFUV-NAJPO-VKFKO'\x3e\x3c/script\x3e");var _streetViewDiv;function TYShowQQOpenStreetView(a,e,b,c,d){var g="yes";"undefined"==typeof d&&(g="no");_streetViewDiv&&(d=_streetViewDiv,document.getElementById(d).style.display="false");"undefined"==typeof d&&(_streetViewDiv=d=TYCeateOpenSteetViewContainer());var h=new qq.maps.LatLng(e,a);document.getElementById(d).innerHTML="";var f=new qq.maps.Panorama(document.getElementById(d));(new qq.maps.PanoramaService).getPano(h,200,function(g){null!=g?(f.setPano(g.svid),g=Math.acos((c-e)/Math.sqrt(Math.pow(b-a,2)+Math.pow(c-e,2))),0>b-a&&(g=2*Math.PI-g),f.setPov({heading:g/Math.PI*180,pitch:0})):document.getElementById(d).innerHTML="\u8be5\u8303\u56f4\u4e0d\u5305\u542b\u5168\u666f"});"no"==g&&TYCeateOpenSteetViewContainerCloseButton(d)}function TYCeateOpenSteetViewContainerCloseButton(a){var e=document.getElementById(a);a=document.createElement("div");a.style.position="absolute";a.style.top="1px";a.style.width="45px";a.style.height="15px";a.style.right="1px";a.style.left="auto";a.style.textAlign="center";a.style.verticalAlign="middle";a.style.zIndex="100000000000";a.style.backgroundColor="#73A2d6";a.id="OpenSteetViewContainer02";a.innerHTML='\x3ca href\x3d"#" style\x3d"font-weight:bold;color:#FFFFFF;font-size:12px"  \x3e[\u5173\u95ed]\x3c/a\x3e';e.appendChild(a);e.onclick=function(){e.style.display="none"}}function TYCeateOpenSteetViewContainer(){var a=document.createElement("div");a.style.position="absolute";a.style.bottom="1px";a.style.width="400px";a.style.height="300px";a.style.right="1px";a.style.left="auto";a.style.zIndex="1100";a.id=TYMapRandomString(10);a.style.display="";document.getElementsByClassName("amap-container")[0].appendChild(a);return a.id}function TYMapRandomString(a){a=a||32;var e="";for(i=0;i<a;i++)e+="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678".charAt(Math.floor(48*Math.random()));return e}function getSortFun(a,e){return new Function("a","b","return a."+e+("asc"==a?"\x3e":"\x3c")+"b."+e+"?1:-1")}var TYMassPoint=function(a){_map.on("pointermove",function(a){a=_map.getEventPixel(a.originalEvent);a=_map.hasFeatureAtPixel(a);_map.getTargetElement().style.cursor=a?"pointer":""});if(a){a.massPointDatas||console.log("\u53c2\u6570\u7f3a\u5931");a.massPointState.isClearOverlay&&TYClear();var e=[],b=a.massPointDatas,c=b.sort(getSortFun("asc","lng")),d=b.sort(getSortFun("asc","lat")),g;for(g in b){var h,f,l,k,n;l=b[g].opacity?b[g].opacity:1;f=b[g].color?RGBA(b[g].color,l):RGBA("#3399CC",1);n=b[g].url?b[g].url:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b.png";b[g].size?(4==b[g].size&&(k=20),3==b[g].size&&(k=15),2==b[g].size&&(k=10),1==b[g].size&&(k=5)):k=10;1==b[g].type?h=new ol.style.Style({image:new ol.style.Icon({opacity:l,src:n,anchor:[1,1]})}):2==b[g].type?h=new ol.style.Style({image:new ol.style.Circle({radius:k,fill:new ol.style.Fill({color:f})})}):3==b[g].type?h=new ol.style.Style({image:new ol.style.RegularShape({points:5,radius:k,radius2:k/2,angle:0,fill:new ol.style.Fill({color:f})})}):4==b[g].type?h=new ol.style.Style({image:new ol.style.RegularShape({points:3,radius:k,radius2:k/3,angle:Math.PI/3,fill:new ol.style.Fill({color:f})})}):5==b[g].type&&(h=new ol.style.Style({image:new ol.style.RegularShape({points:4,radius:k,angle:Math.PI/4,fill:new ol.style.Fill({color:f})})}));f=ol.proj.fromLonLat([b[g].lng,b[g].lat]);f=new ol.geom.Point(f);f=new ol.Feature({geometry:f});f.setId(b[g].id);f.setStyle(h);f.color=b[g].color;f.opacity=l;f.size=k;f.url=n;f.type=b[g].type;e.push(f)}if(a.massPointState.overlayEvent){var p=function(b){var c={},d=b.getGeometry().getCoordinates(),d=new GPSLngLat(d[0],d[1]);c.GPSlng=d.GPSLng;c.GPSlat=d.GPSLat;c.color=b.color;c.id=b.getId();c.opacity=l;c.size=b.size;c.type=b.type;c.url=b.url;a.massPointState.overlayEvent.mouseFunc(c)},b=_map.on(a.massPointState.overlayEvent.mouseEvent,function(a){(a=_map.forEachFeatureAtPixel(a.pixel,function(a){return a}))&&p(a)});_ty_point.push(b)}e=new ol.source.Vector({features:e});e=new ol.layer.Vector({zIndex:5E4,updateWhileAnimating:!0,updateWhileInteracting:!0,source:e});_map.addLayer(e);_ty_cluster.push(e);e=ol.proj.fromLonLat([c[0].lng,d[0].lat]);c=ol.proj.fromLonLat([c[c.length-1].lng,d[d.length-1].lat]);_map.getView().fit([e[0],e[1],c[0],c[1]],_map.getSize())}},_ty_locus,animating=!1,speed,now,TYMoveLocus_OL3\u8f68\u8ff9\u56de\u653e_=function(a){function e(a){animating=!1;a=a?l[k-1]:l[0];h.getGeometry().setCoordinates(a);h.setStyle(g.geoMarker);_map.un("postcompose",p)}a.locusState.isClearOverlay&&TYClear();var b,c,d;a.locusData&&(a.locusData.nodeIcon&&(c=a.locusData.nodeIcon),a.locusData.label&&(b=a.locusData.label.content),a.locusData.label&&(d=a.locusData.label.offset));var g={route:new ol.style.Style({stroke:new ol.style.Stroke({width:2,color:[237,212,0,.8]})}),node:new ol.style.Style({image:new ol.style.Circle({radius:7,stroke:new ol.style.Stroke({color:RGBA("#ffffff",1),width:2}),fill:new ol.style.Fill({color:RGBA("#000000",.7)})})}),icon1:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:c}),text:new ol.style.Text({font:"13px Microsoft Yahei",fill:new ol.style.Fill({color:"#aa3300"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),textAlign:"left"})}),icon2:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:c}),text:new ol.style.Text({font:"13px Microsoft Yahei",fill:new ol.style.Fill({color:"#aa3300"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),textAlign:"left"})}),geoMarker:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,.5],rotation:0,size:[52,26],src:"http://webapi.amap.com/images/car.png"}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:b,fill:new ol.style.Fill({color:"#aa3300"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),offsetX:d[0],offsetY:d[1],textAlign:"left"})})};c=[];b=new ol.style.Style({stroke:new ol.style.Stroke({width:5,color:[237,212,0,.8]})});d=new ol.Feature(new ol.geom.LineString(a.locusData.lnglat));d.setId(a.locusData.locusId);d.setStyle(b);c.push(d);b=a.locusData.lnglat;var h=new ol.Feature({type:"geoMarker",geometry:new ol.geom.Point(b[0])});h.setStyle(g.geoMarker);c.push(h);for(var f in b)0<f&&f<b.length-1||(0==f?(d=new ol.Feature({type:"icon1",geometry:new ol.geom.Point(b[f])}),c.push(d)):f==b.length-1&&(d=new ol.Feature({type:"icon2",geometry:new ol.geom.Point(b[f])}),c.push(d)));var l=b,k=b.length;f=new ol.layer.Vector({zIndex:5E4,source:new ol.source.Vector({features:c}),style:function(a){return"geoMarker"===a.get("type")?null:g[a.get("type")]}});_map.addLayer(f);_ty_cluster.push(f);a.locusState.overlayEvent&&(f=_map.on(a.locusState.overlayEvent.mouseEvent,function(b){var c=_map.forEachFeatureAtPixel(b.pixel,function(a){return a});c&&(b={},c=c.getGeometry().getCoordinates(),c=new GPSLngLat(c[0],c[1]),b.GPSlng=c.GPSLng,b.GPSlat=c.GPSLat,a.locusState.overlayEvent.mouseFunc(b))}),_ty_point.push(f));f=b.sort()[0];b=b.sort()[k-1];_map.getView().fit([f[0],f[1],b[0],b[1]],_map.getSize());var n=parseInt(formatLength(l)/400)/l.length;console.log(l.length);var p=function(a){var b,c,d,f=a.vectorContext;a=a.frameState;if(animating){b=Math.round(speed*(a.time-now)/1E3);if(b>=k){e(!0);return}a=new ol.geom.Point(l[b]);var h=new ol.Feature(a),n=g.geoMarker;if(b!=l.length-1){c=_map.getPixelFromCoordinate(l[b+1])[0];d=_map.getPixelFromCoordinate(l[b+1])[1];a=_map.getPixelFromCoordinate(l[b])[0];b=_map.getPixelFromCoordinate(l[b])[1];var p=Math.abs(c-a),m=Math.abs(d-b),p=Math.round(Math.asin(m/Math.sqrt(p*p+m*m))/Math.PI*180),m=0;d<b&&c==a?m=270:d>b&&c==a?m=90:d==b&&c<a?m=180:d==b&&c>a?m=0:d>b&&c>a?m=p:d>b&&c<a?m=180-p:d<b&&c<a?m=180+p:d<b&&c>a&&(m=360-p);360>=m&&0<=m&&n.getImage().setRotation(Math.PI*m/180)}f.drawFeature(h,n)}_map.render()};_ty_locus=p;_ty_locus.start=function(){animating?e(!1):(animating=!0,now=(new Date).getTime(),speed=n,h.setStyle(null),_map.on("postcompose",p),_map.render())};_ty_locus.stop=function(){e(!1)};_ty_locus.pause=function(){e(!0)}},TYMoveLocus=function(a,e){_ty_locus&&_ty_locus.stop();try{var b=a.locusState,c=a.locusData;b.isClearOverlay&&TYClear(e);if(!e){var d=[];d.push("TYMoveLocus");d.push(a);_ty_overlays.push(d)}_TYDrawLinesAndMarkers(c,b);_ty_locus=new TYMapLib.TYTrack(_map,c.lnglat,{defaultContent:c.label,autoView:b.isSetView,speed:b.moveSpeed,enableRotation:!0,circlable:b.circlable,func:b.syncEvent})}catch(g){console.log(g.message)}};function TYLocusStart(){_ty_locus&&_ty_locus.start()}function TYLocusStop(){_ty_locus&&_ty_locus.stop()}function TYLocusPause(){_ty_locus&&_ty_locus.pause()}function _TYDrawLinesAndMarkers(a,e){a&&(a.nodeIcon&&(image=a.nodeIcon),a.label&&(text=a.label.content),a.label&&(offset=a.label.offset));e&&TYClear();var b={route:new ol.style.Style({stroke:new ol.style.Stroke({width:2,color:[237,212,0,.8]})}),node:new ol.style.Style({image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:RGBA("#ffffff",1),width:2}),fill:new ol.style.Fill({color:RGBA("#000000",.7)})})}),icon1:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:image}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:"\u8d77\u70b9",fill:new ol.style.Fill({color:"#aa3300"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),textAlign:"left"})}),icon2:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],src:image}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:"\u7ec8\u70b9",fill:new ol.style.Fill({color:"#aa3300"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),textAlign:"left"})}),geoMarker:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,.5],rotation:0,size:[52,26],src:"http://webapi.amap.com/images/car.png"}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:text,fill:new ol.style.Fill({color:"#aa3300"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),offsetX:offset[0],offsetY:offset[1],textAlign:"left"})})},c=[],d=new ol.style.Style({stroke:new ol.style.Stroke({width:5,color:[237,212,0,.8]})}),g=new ol.Feature(new ol.geom.LineString(a.lnglat));g.setId(a.locusId);g.setStyle(d);c.push(g);var h=a.lnglat,d=[],g=[],f;for(f in h){if(0<f&&f<h.length-1){var l=new ol.Feature({type:"node",geometry:new ol.geom.Point(a.lnglat[f])});c.push(l)}else 0==f?(l=new ol.Feature({type:"icon1",geometry:new ol.geom.Point(h[f])}),c.push(l)):f==h.length-1&&(l=new ol.Feature({type:"icon2",geometry:new ol.geom.Point(h[f])}),c.push(l));d.push(h[f][0]);g.push(h[f][1])}c=new ol.layer.Vector({zIndex:5E4,source:new ol.source.Vector({features:c}),style:function(a){return"geoMarker"===a.get("type")?null:b[a.get("type")]}});_map.addLayer(c);_ty_cluster.push(c);c=document.createElement("div");c.id="mycar_title";c.innerHTML=text;c=new ol.Overlay({id:"_ty_lj_key_title",position:[d[0][0],g[0][1]],stopEvent:!1,offset:offset,positioning:"bottom-left",element:c});_map.addOverlay(c);_ty_popup.push(c);_ty_box(d,g);e.overlayEvent&&(d=_map.on(e.overlayEvent.mouseEvent,function(a){var b=_map.forEachFeatureAtPixel(a.pixel,function(a){return a});b&&(a={},b=b.getGeometry().getCoordinates(),b=new GPSLngLat(b[0],b[1]),a.lng=b.GPSLng,a.lat=b.GPSLat,e.overlayEvent.mouseFunc(a))}),_ty_point.push(d))}function TYCar(a,e){var b=document.createElement("div");b.id="mymovecar";b.style.position="absolute";var c=document.createElement("img");e.icon&&(c.src=e.icon);b.appendChild(c);b=new ol.Overlay({id:"_ty_lj_key_car",stopEvent:!1,offset:[-26,-13],positioning:"center-center",element:b});b.setPosition(a);b.setRotation=function(a){!isNaN(a)&&360>=a&&0<=a&&(document.getElementById("mymovecar").style.transform="rotate("+a+"deg)")};return b}var TYMapLib=window.TYMapLib=TYMapLib||{};(function(){var a=TYMapLib.TYTrack=function(a,b,c){!b||1>b.length||(this.ismove=!1,this._cc=0,this._map=a,this._path=b,this.i=0,this._setTimeoutQuene=[],this._opts={icon:null,speed:400,defaultContent:""},this._setOptions(c),this._rotation=0,this._opts.icon||(this._opts.icon="http://webapi.amap.com/images/car.png"))};a.prototype._setOptions=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this._opts[b]=a[b])};a.prototype.start=function(){this.ismove=!0;var a=this,b=a._path.length;if(a.i&&a.i<b-1)if(a._fromPause)a._fromStop||a._moveNext(++a.i);else return;else a._addMarker(),a._timeoutFlag=setTimeout(function(){a._moveNext(a.i)},400);this._fromStop=this._fromPause=!1};a.prototype.stop=function(){this.ismove=!1;this.i=0;this._fromStop=!0;clearInterval(this._intervalFlag);this._clearTimeout()};a.prototype.pause=function(){clearInterval(this._intervalFlag);this._fromPause=!0;this._clearTimeout()};a.prototype.hideInfoWindow=function(){this._overlay._div.style.visibility="hidden"};a.prototype.showInfoWindow=function(){this._overlay._div.style.visibility="visible"};a.prototype._addMarker=function(a){this._marker&&(this.stop(),this._marker.setMap(null),clearTimeout(this._timeoutFlag));this._overlay&&this._overlay.setMap(null);a=new TYCar(this._path[0],this._opts);_map.addOverlay(a);_ty_popup.push(a);this._marker=a};a.prototype._addInfoWin=function(){var a=new CustomOverlay(this._marker.getLngLat(),this._opts.defaultContent);a.setRelatedClass(this);this._overlay=a;this._map.TYaddOverLay(a)};a.prototype._getDistance=function(a,b){return formatLength([a,b])};a.prototype._move=function(a,b,c,d){var e=this;e.ismove=!0;d||(d=0);var h=this._opts.speed/100,f=this._map.getPixelFromCoordinate(a),l=this._map.getPixelFromCoordinate(b),k=Math.round(e._getDistance(f,l)/h);1>k?e._moveNext(++e.i):e._intervalFlag=setInterval(function(){if(d>=k)clearInterval(e._intervalFlag),e.i>e._path.length||e._moveNext(++e.i);else{d++;e._cc=d;var g=c(f[0],l[0],d,k),h=c(f[1],l[1],d,k),g=e._map.getCoordinateFromPixel([g,h]);1==d&&(h=null,0<=e.i-1&&(h=e._path[e.i-1]),1==e._opts.enableRotation&&e.setRotation(h,a,b));var m=_map.getView().calculateExtent(_map.getSize()),h=ol.extent.getBottomLeft(m),m=ol.extent.getTopRight(m),h=ol.extent.containsCoordinate([h[0],h[1],m[0],m[1]],g);_map.getOverlayById("_ty_lj_key_title").setPosition(g);h?e._marker.setPosition(g):e._opts.autoView?(clearInterval(e._intervalFlag),_map.getView().setCenter(g),e._move(a,b,e._tween.linear)):e._marker.setPosition(g)}},10)};a.prototype.setRotation=function(a,b,c){b=this._map.getPixelFromCoordinate(b);c=this._map.getPixelFromCoordinate(c);b={x:b[0],y:b[1]};c={x:c[0],y:c[1]};a=Math.abs(c.x-b.x);var d=Math.abs(c.y-b.y);a=Math.round(Math.asin(d/Math.sqrt(a*a+d*d))/Math.PI*180);d=0;c.y<b.y&&c.x==b.x?d=270:c.y>b.y&&c.x==b.x?d=90:c.y==b.y&&c.x<b.x?d=180:c.y==b.y&&c.x>b.x?d=0:c.y>b.y&&c.x>b.x?d=a:c.y>b.y&&c.x<b.x?d=180-a:c.y<b.y&&c.x<b.x?d=180+a:c.y<b.y&&c.x>b.x&&(d=360-a);this._marker.setRotation(d)};a.prototype.linePixellength=function(a,b){return Math.sqrt(Math.abs(a.x-b.x)*Math.abs(a.x-b.x)+Math.abs(a.y-b.y)*Math.abs(a.y-b.y))};a.prototype.pointToPoint=function(a,b){return Math.abs(a.x-b.x)*Math.abs(a.x-b.x)+Math.abs(a.y-b.y)*Math.abs(a.y-b.y)};a.prototype._moveNext=function(a){this.ismove=!0;this._opts.func&&""!=this._opts.func&&_opts.func(a);var b=this;a==b._path.length-1&&b._opts.circlable&&(a=0,b.i=0);if(a<this._path.length-1){var c=b._path[a],d=b._path[a+1],e=_map.getView().calculateExtent(_map.getSize()),h=ol.extent.getBottomLeft(e),f=ol.extent.getTopRight(e),f=[_map.getPixelFromCoordinate(f)[0]-30,_map.getPixelFromCoordinate(f)[1]+30],h=[_map.getPixelFromCoordinate(h)[0]+30,_map.getPixelFromCoordinate(f)[1]-30],f=_map.getCoordinateFromPixel(f),h=_map.getCoordinateFromPixel(h),e=ol.extent.containsCoordinate([h[0],h[1],f[0],f[1]],c),h=ol.extent.containsCoordinate([h[0],h[1],f[0],f[1]],d);if(0==e||0==h)if(b._opts.autoView){clearInterval(_ty_locus._intervalFlag);var f=(d[0]-c[0])/2+d[0],l=(d[1]-c[1])/2+d[1];if(0==e&&0==h)_map.getView().setCenter([f,l]);else if(0==e)_map.getView().setCenter(c);else if(0==h)_map.getView().setCenter(d);else{console.log("#1005853");return}setTimeout(function(){b._move(b._path[a],b._path[a+1],b._tween.linear)},100)}else b._move(b._path[a],b._path[a+1],b._tween.linear);else b._move(b._path[a],b._path[a+1],b._tween.linear)}};a.prototype._setInfoWin=function(a){if(this._overlay){this._overlay.setPosition(a,this._marker.getIcon().size);var b=this._troughPointIndex(a);-1!=b?(clearInterval(this._intervalFlag),this._overlay.setPosition(a,this._marker.getIcon().getSize()),this._pauseForView(b)):this._overlay.setHtml(this._opts.defaultContent)}};a.prototype._pauseForView=function(a){var b=this;a=setTimeout(function(){b._moveNext(++b.i)},1E3*b._opts.landmarkPois[a].pauseTime);b._setTimeoutQuene.push(a)};a.prototype._clearTimeout=function(){for(var a in this._setTimeoutQuene)clearTimeout(this._setTimeoutQuene[a]);this._setTimeoutQuene.length=0};a.prototype._tween={linear:function(a,b,c,d){return(b-a)*c/d+a}};a.prototype._troughPointIndex=function(a){for(var b=this._opts.landmarkPois,c,d=0,e=b.length;d<e;d++)if(!b[d].bShow&&(c=a.distance(new AMap.LngLat(b[d].lng,b[d].lat)),10>c))return b[d].bShow=!0,d;return-1}})();var formatLength=function(a){for(var e=new ol.Sphere(6378137),b=0,c=_map.getView().getProjection(),d=0,g=a.length-1;d<g;++d)var h=ol.proj.transform(a[d],c,"EPSG:4326"),f=ol.proj.transform(a[d+1],c,"EPSG:4326"),b=b+e.haversineDistance(h,f);return b},formataArea=function(a){for(var e=new ol.Sphere(6378137),b=_map.getView().getProjection(),c=[],d=0;d<a.length;d++)c.push(ol.proj.transform(a[d],b,"EPSG:4326"));a=e.geodesicArea(c);return Math.abs(a)},TYAreaRender=function(a,e){a.renderState.isClearOverlay&&TYClear();if(!e){var b=[];b.push("TYAreaRender");b.push(a);_ty_overlays.push(b)}var b="100000",c=a.renderDatas;"0000"==c[0].renderId.substr(2,4)?b="101":"00"==c[0].renderId.substr(4,2)&&(b="102");var d=a.renderState,g="",h="",f="",l;for(l in c)g+=c[l].renderId+",",h+=c[l].fillColor.replace("#","")+",",f+=c[l].borderColor.replace("#","")+",",c[l].icon&&""!=c[l].icon&&_addAreaMarker(c[l],d.overlayEvent);g=g.substring(0,g.length-1);h=h.substring(0,h.length-1);f=f.substring(0,f.length-1);_addAreaRender(h,f,g,b);.4<d.tileOpacity&&_addAreaRender(h,f,g,b);.6<d.tileOpacity&&_addAreaRender(h,f,g,b);d.isSetView&&(_map.getView().setCenter(c[0].lnglat),"0000"==c[0].renderId.substr(2,4)?TYSetLevel(6):"00"==c[0].renderId.substr(4,2)&&TYSetLevel(8))};function _addAreaMarker(a,e){var b,c;a.label&&""!=a.label&&(b=a.label.content);a.label.offset&&(c=a.label.offset);var d=new ol.style.Style({image:new ol.style.Circle({radius:7,stroke:new ol.style.Stroke({color:RGBA("#ffffff",1),width:3}),fill:new ol.style.Fill({color:RGBA("#FF4500",.9)})}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:b,fill:new ol.style.Fill({color:"#FF4500"}),stroke:new ol.style.Stroke({color:"#ffffff",width:2}),offsetX:a.label.offset[0],offsetY:a.label.offset[1],textAlign:"left"})});if(a.icon){var d=new ol.style.Style({image:new ol.style.Icon({opacity:1,src:a.icon,anchor:[.5,1]})}),g=document.createElement("div");g.innerHTML=b;b=new ol.Overlay({id:"_ty_lj_key_",stopEvent:!1,positioning:"center",offset:c,element:g});b.setPosition(a.lnglat);_map.addOverlay(b);_ty_popup.push(b)}b=new ol.Feature({geometry:new ol.geom.Point(a.lnglat)});b.setStyle(d);d=new ol.layer.Vector({zIndex:7E5,source:new ol.source.Vector({features:[b]})});_map.addLayer(d);_ty_cluster.push(d);e&&""!=e&&(d=_map.on(e.mouseEvent,function(b){_map.forEachFeatureAtPixel(b.pixel,function(a){return a})&&(b=new GPSLngLat(a.lnglat.lng,a.lnglat.lat),a.lnglat=b,e.mouseFunc&&e.mouseFunc(a))}),_ty_point.push(d))}function _addAreaRender(a,e,b,c){a=new ol.source.XYZ({minZoom:3,url:"http://api4.tygps.com:8080/sisserver?config\x3dDISTRICTRENDER\x26userId\x3d"+c+"\x26zoom\x3d{z}\x26x\x3d{x}\x26y\x3d{y}\x26areacode\x3d"+b+"\x26areacolor\x3d"+a+"\x26areaoutlinecolor\x3d"+e+"\x26a_k\x3d2b592e22ba43480912bf4063a7f082af2d7cfe858d396f9047754b91e68d992920b521280cd9d351"});a=new ol.layer.Tile({zIndex:6E5,source:a});_map.addLayer(a);_ty_cluster.push(a)}var _tracffic_t,TYOpenTraffic=function(a,e){addtraffic(a);_tracffic_t=setInterval(function(){addtraffic(a)},e)};function addtraffic(a){if(_ty_cluster){for(var e in _ty_cluster)_map.removeLayer(_ty_cluster[e]);clearInterval(_tracffic_t)}var b;1==a?b=new ol.source.XYZ({url:"http://map.so.com/app/traffic.php?act\x3dtile\x26x\x3d{x}\x26y\x3d{-y}\x26z\x3d{z}"}):2==a?b=new ol.source.XYZ({url:"http://rtt2a.map.qq.com/rtt/?x\x3d{x}\x26y\x3d{y}\x26z\x3d{z}"}):3==a&&(b=new ol.source.XYZ({url:"http://map.so.com/app/traffic.php?act\x3dtile\x26x\x3d{x}\x26y\x3d{-y}\x26z\x3d{z}"}));a=new ol.layer.Tile({zIndex:5E4,source:b});_map.addLayer(a);_ty_cluster.push(a)}var TYCloseTraffic=function(){if(_ty_cluster){for(var a in _ty_cluster)_map.removeLayer(_ty_cluster[a]);clearInterval(_tracffic_t)}};function RGBA(a,e){if(-1==a.indexOf("#"))return a;var b="#"==a.charAt(0)?a.substring(1):a,c=parseInt(b.substring(0,2),16),d=parseInt(b.substring(2,4),16),b=parseInt(b.substring(4,6),16);return"rgba("+c+","+d+","+b+","+e+")"}function _ty_box(a,e){try{var b=[a.sort()[0],a.sort()[a.sort().length-1]],c=[e.sort()[0],e.sort()[e.sort().length-1]];_map.getView().fit([b[0],c[0],b[1],c[1]],_map.getSize())}catch(d){console.log(d.message)}}var url_para=function(){return 2==_ty_layers_id?TYEnumMapUrl.TY_GAODE.URL_SL:3==_ty_layers_id?TYEnumMapUrl.TY_GAODE.URL_WX:7==_ty_layers_id?TYEnumMapUrl.TY_360.URL_SL:9==_ty_layers_id?TYEnumMapUrl.TY_GOOGLE.URL_SL:10==_ty_layers_id?TYEnumMapUrl.TY_GOOGLE.URL_WX:11==_ty_layers_id?TYEnumMapUrl.TY_GOOGLE.URL_DX:12==_ty_layers_id?TYEnumMapUrl.TY_TIANDITU.URL_SL:13==_ty_layers_id?TYEnumMapUrl.TY_TIANDITU.URL_WX:14==_ty_layers_id?TYEnumMapUrl.TY_TIANYUAN.URL_SL:15==_ty_layers_id?TYEnumMapUrl.TY_OL3.URL_SL:16==_ty_layers_id?TYEnumMapUrl.TY_OL3.URL_DX:TYEnumMapUrl.TY_OL3.URL_SL},TYMapTiles=function(a){if(_map){for(var e in _ty_source)_map.removeLayer(_ty_source[e]);var b=_ty_layers_id,c=a.TYMapType;a&&(_ty_layers_id=a.TYMapType);a=url_para();var d="",g=[];for(e=0;e<a.length;e++){0==e&&(d=new ol.Attribution({html:_ty_copy}));var h;h=14==_ty_layers_id?new ol.source.TileWMS({attributions:[d],url:a[e],params:{request:"GetMap",layers:"tyall:TYMap_Demo"},serverType:"geoserver"}):new ol.source.XYZ({attributions:[d],url:a[e]});h=new ol.layer.Tile({zIndex:e,source:h});_map.addLayer(h);g.push(h)}_ty_source=g;if(12<=c&&12>b)for(TYClear(),e=0;e<_ty_overlays.length;e++)_TYRe(_ty_overlays[e],!0);else if(12>c&&12<=b)for(TYClear(),e=0;e<_ty_overlays.length;e++)_TYRe(_ty_overlays[e],!1)}},src__ty="http://webapi.amap.com/maps?v\x3d1.3\x26key\x3df1ddbd6ae784f34719f5b756c7814422\x26plugin\x3dAMap.Driving,AMap.DistrictSearch,",src__ty=src__ty+"AMap.CustomLayer,AMap.Geocoder,AMap.Heatmap,AMap.Geolocation,AMap.Weather";document.write("\x3cscript type\x3d'text/javascript' src\x3d"+src__ty+" \x3e\x3c/script\x3e");function TYDistrictSearch(a,e){try{(new AMap.DistrictSearch({subdistrict:0,extensions:"all"})).search(a.code,function(b,c){var d={status:!1};if("complete"==b){d.status=!0;d.district={};var g=c.districtList[0].boundaries,h=[],f=[],l;for(l in g){for(var k in g[l])f.push(new GPSLngLat(g[l][k].lng,g[l][k].lat));h.push(f)}d.district.polyine=h;d.district.citycode=c.districtList[0].citycode;d.district.adcode=c.districtList[0].adcode;d.district.name=c.districtList[0].name;d.district.center=GPS.gcj_decrypt(c.districtList[0].center.lat,c.districtList[0].center.lng);if(a.isDrawArea&&(a.isClearOverlay&&TYClear(),e||(g=[],g.push("TYDistrictSearch"),g.push(a),_ty_overlays.push(g)),l=[],c.districtList[0].boundaries)){f=[];g=[];h=[];k=0;for(var n=c.districtList[0].boundaries.length;k<n;k++){for(var p=[],m=0;m<c.districtList[0].boundaries[k].length;m++){var r=GPS.gcj_decrypt(c.districtList[0].boundaries[k][m].lat,c.districtList[0].boundaries[k][m].lng);p.push(new ol.proj.fromLonLat([r.lng,r.lat]));r=new ol.proj.fromLonLat([c.districtList[0].boundaries[k][m].lng,c.districtList[0].boundaries[k][m].lat]);g.push(r[0]);h.push(r[1])}l.push(p)}p=new ol.style.Style({stroke:new ol.style.Stroke({width:a.lineWidth,color:RGBA(a.lineColor,a.lineOpacity)}),fill:new ol.style.Fill({color:RGBA(a.fillColor,a.fillOpacity)})});k=0;for(n=l.length;k<n;k++)m=new ol.Feature(new ol.geom.Polygon([l[k]])),m.setStyle(p),f.push(m);p=new ol.style.Style({image:new ol.style.Circle({radius:7,stroke:new ol.style.Stroke({color:RGBA("#ffffff",1),width:3}),fill:new ol.style.Fill({color:RGBA("#FF4500",.9)})}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:d.district.name,offsetX:15,offsetY:0,fill:new ol.style.Fill({color:"#FF4500"}),stroke:new ol.style.Stroke({color:"#ffffff",width:2}),textAlign:"left"})});l=new ol.Feature({geometry:new ol.geom.Point(new TYLngLat(c.districtList[0].center.lng,c.districtList[0].center.lat))});l.setStyle(p);f.push(l);f=new ol.layer.Vector({zIndex:6E4,source:new ol.source.Vector({features:f})});_map.addLayer(f);_ty_cluster.push(f);_ty_box(g,h)}}a.callback&&a.callback(d)})}catch(b){console.log(b.message)}}var TYconvertFrom=function(a){if(a)try{if(a.lnglats[0][1]){var e=[],b;for(b in a.lnglats)e.push(convertLngLat(a.oType,a.tType,a.lnglats[b]));return e}return convertLngLat(a.oType,a.tType,a.lnglats)}catch(c){console.log(c.message)}else console.log("\u53c2\u6570\u7f3a\u5931")};function convertLngLat(a,e,b){if(1==a)switch(e){case 2:return a=GPS.gcj_encrypt(Number(b[1]),Number(b[0])),[a.lng,a.lat];case 3:return a=GPS.gcj_encrypt(Number(b[1]),Number(b[0])),a=GPS.bd_encrypt(a.lat,a.lng),[a.lng,a.lat]}else if(2==a)switch(e){case 1:return a=GPS.gcj_decrypt(Number(b[1]),Number(b[0])),[a.lng,a.lat];case 3:return a=GPS.bd_encrypt(Number(b[1]),Number(b[0])),[a.lng,a.lat]}else if(3==a)switch(e){case 1:return a=GPS.bd_decrypt(Number(b[1]),Number(b[0])),a=GPS.gcj_decrypt(a.lat,a.lng),[a.lng,a.lat];case 2:return a=GPS.bd_decrypt(Number(b[1]),Number(b[0])),[a.lng,a.lat]}}var TYWeather=function(a){var e=a.district,b=a.callback;(new AMap.Weather).getLive(e,function(a,d){var c={status:!1};a||(c.status=!0,c.city=d.city,c.weather=d.weather,c.temperature=d.temperature,c.windDirection=d.windDirection,c.windPower=d.windPower,c.humidity=d.humidity,c.reportTime=d.reportTime);b&&b(c)})},TYGeolocation=function(a){function e(b){if(b.status&&b.position){var c=new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#ffffff",width:2})})});b=GPS.gcj_encrypt(b.position.lat,b.position.lng);b=ol.proj.fromLonLat([b.lng,b.lat]);var d=new ol.geom.Point(b),d=new ol.Feature({geometry:d});d.setStyle(c);c=new ol.source.Vector({features:[d]});c=new ol.layer.Vector({zIndex:5E4,source:c});_map.addLayer(c);_ty_cluster.push(c);TYSetLevel(11);a.panToLocation&&TYSetCenter(b)}}TYClear();var b=new AMap.Map("iCenter"),c=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1E4,showButton:a.showButton,buttonOffset:a.buttonOffset,zoomToAccuracy:a.zoomToAccuracy,showMarker:a.showMarker,showCircle:a.showCircle,buttonPosition:a.buttonPosition,panToLocation:a.panToLocation});b.addControl(c);c.getCurrentPosition();AMap.event.addListener(c,"complete",function(b){var c={status:!0,position:b.position,accuracy:b.accuracy,info:"ok"};b.isConverted&&(c.position=GPS.gcj_decrypt(b.position.getLat(),b.position.getLng()));null==b.position&&(c.info="\u5b9a\u4f4d\u5931\u8d25");a.callback&&a.callback(c);a.showMarker&&e(c);a.showButton&&((b=document.getElementById("geoDingWei"))&&b.remove(),b=document.createElement("div"),b.style.position="absolute",b.id="geoDingWei",b.style.left="6px",b.style.top="260px",b.className="ol-control",b.addEventListener("click",function(){addButtonClick()}),b.innerHTML="\x3cbutton type\x3d'button' title\x3d'\u5b9a\u4f4d'\x3e\x3cspan\x3e\u2022\x3c/span\x3e\x3c/button\x3e",(new ol.control.Control({element:b})).setMap(_map))});AMap.event.addListener(c,"error",function(b){b={status:!1,position:null,accuracy:null,info:"\u5b9a\u4f4d\u5931\u8d25"};a.callback&&a.callback(b)})};function addButtonClick(){function a(a){if(a.status&&a.position){var b=new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#ffffff",width:2})})});a=GPS.gcj_encrypt(a.position.lat,a.position.lng);a=ol.proj.fromLonLat([a.lng,a.lat]);var c=new ol.geom.Point(a),c=new ol.Feature({geometry:c});c.setStyle(b);b=new ol.source.Vector({features:[c]});b=new ol.layer.Vector({zIndex:5E4,source:b});_map.addLayer(b);_ty_cluster.push(b);TYSetLevel(11);TYSetCenter(a)}}TYClear();var e=new AMap.Map("iCenter"),b=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1E4});e.addControl(b);b.getCurrentPosition();AMap.event.addListener(b,"complete",function(b){var c={status:!0,position:b.position,accuracy:b.accuracy,info:"ok"};b.isConverted&&(c.position=GPS.gcj_decrypt(b.position.getLat(),b.position.getLng()));null==b.position&&(c.info="\u5b9a\u4f4d\u5931\u8d25");a(c);(b=document.getElementById("geoDingWei"))&&b.remove();b=document.createElement("div");b.style.position="absolute";b.id="geoDingWei";b.style.left="6px";b.style.top="260px";b.className="ol-control";b.addEventListener("click",function(){addButtonClick()});b.innerHTML="\x3cbutton type\x3d'button' title\x3d'\u5b9a\u4f4d'\x3e\x3cspan\x3e\u2022\x3c/span\x3e\x3c/button\x3e";(new ol.control.Control({element:b})).setMap(_map)});AMap.event.addListener(b,"error",function(a){})}var TYSpAsis=function(a){if(a)try{if(a.sisType||console.log("\u7a7a\u95f4\u8ba1\u7b97\u53c2\u6570\u7f3a\u5931"),a.sisType==TYEnumSpAsis.P_PGON){var e=[],b;for(b in a.polyGon)e.push(ol.proj.toLonLat([a.polyGon[b][0],a.polyGon[b][1]]));if(a.point&&a.polyGon)return(new AMap.Polygon({path:e})).contains(ol.proj.toLonLat([a.point[0],a.point[1]]));console.log("\u8ba1\u7b97\u7f3a\u5c11\u53c2\u6570")}else if(a.sisType==TYEnumSpAsis.LINE_SIS){if(a.polyLine)return formatLength(a.polyLine);console.log("\u8ba1\u7b97\u7f3a\u5c11\u53c2\u6570")}else if(a.sisType==TYEnumSpAsis.PLOYGON_SIS){if(a.polyGon)return formataArea(a.polyGon);console.log("\u8ba1\u7b97\u7f3a\u5c11\u53c2\u6570")}}catch(c){console.log(c.message)}},TYGetLocation=function(a){if(a)try{a.callback&&a.address&&""!=a.address.replace(/\s/g,"")||console.log("\u5730\u7406\u7f16\u7801\u53c2\u6570\u7f3a\u5931"),(new AMap.Geocoder({radius:3E3})).getLocation(a.address,function(e,b){if("complete"===e&&"OK"===b.info){for(var c=[],d=b.geocodes,g=0;g<d.length;g++){var h=GPS.gcj_decrypt(d[g].location.lat,d[g].location.lng);c.push({adress:d[g].formattedAddress,province:d[g].addressComponent.province,city:d[g].addressComponent.city,citycode:d[g].addressComponent.citycode,district:d[g].addressComponent.district,GPSLngLat:{GPSLng:h.lng,GPSLat:h.lat},acode:d[g].adcode,township:d[g].addressComponent.township,street:d[g].addressComponent.street})}c={status:!0,count:d.length,geocodes:c};a.callback&&a.callback(c)}else console.log("\u89e3\u6790\u5931\u8d25")})}catch(e){console.log(e.message)}},TYGeoCoder=function(a){if(a){a.callback&&a.location||console.log("\u9006\u5411\u5730\u7406\u7f16\u7801\u53c2\u6570\u7f3a\u5931");var e=new AMap.Geocoder({extensions:"all",radius:1E3}),b=[];if(a.batch)if(1<=a.location.length)for(var c in a.location)b.push(ol.proj.toLonLat([a.location[c][0],a.location[c][1]]));else console.log("\u9006\u5411\u5730\u7406\u7f16\u7801\u53c2\u6570\u7f3a\u5931\uff0c\u5fc5\u987b\u662f\u6570\u7ec4\u3002");else b.push(ol.proj.toLonLat([a.location[0],a.location[1]]));e.getAddress([[114,37],[114,37.5],[114,37.7]],function(b,c){if("complete"===b&&"OK"===c.info){for(var d=[],e,g=c.regeocodes,k=0;k<g.length;k++){var n=e="",p="",m="",r="",v="",B="",y="",C="",u=null;g[k].pois[0]&&(g[k].pois[0].name&&(e=g[k].pois[0].name),g[k].pois[0].distance&&(p=g[k].pois[0].distance),g[k].pois[0].distance&&(n=g[k].pois[0].direction),g[k].pois[0]?g[k].pois[0].location?(u=GPS.gcj_decrypt(g[k].pois[0].location.lat,g[k].pois[0].location.lng),u={GPSLng:u.lng,GPSLat:u.lat}):u={}:u={});g[k].addressComponent&&(g[k].addressComponent.street&&(m=g[k].addressComponent.street),g[k].addressComponent.streetNumber&&(r=g[k].addressComponent.streetNumber),g[k].addressComponent.province&&(v=g[k].addressComponent.province),g[k].addressComponent.city&&(B=g[k].addressComponent.city),g[k].addressComponent.township&&(y=g[k].addressComponent.township),g[k].addressComponent.district&&(C=g[k].addressComponent.district));var q=v+B+C;a.type==TYEnumGeocoder.TY_EXACT_DESC?(e&&(q+=e),n&&(q+="\u5411"+n),p&&(q+=p+"\u7c73")):a.type==TYEnumGeocoder.TY_NEAR_DESC?(m&&(q+=m),r&&(q+=r),e&&(q+=e+"\u9644\u8fd1")):a.type==TYEnumGeocoder.TY_ROAD_DESC&&(m&&(q+=m),r&&(q+=r),y&&(q+=y+"\u9644\u8fd1"));e={description:q,Poi:e,direction:n,distance:p,province:v,city:B,township:y,street:m,district:C,GPSLngLat:u};d.push(e)}d={status:!0,geocodes:d};a.callback&&a.callback(d)}else console.log("\u9006\u5411\u89e3\u6790\u5931\u8d25")})}},TYDriving=function(a,e){try{if(!e){var b=[];b.push("TYDriving");b.push(a);_ty_overlays.push(b)}var c=new AMap.Driving({policy:a.policy,panel:a.panelId}),d=ol.proj.toLonLat([a.origin[0],a.origin[1]]),g=ol.proj.toLonLat([a.destination[0],a.destination[1]]);12<=_ty_layers_id&&(d=GPS.gcj_encrypt(d[1],d[0]),g=GPS.gcj_encrypt(g[1],g[0]),d=[d.lng,d.lat],g=[g.lng,g.lat]);b=[];if(a.passWayPoints)if(12<=_ty_layers_id)for(var h in a.passWayPoints){var f=ol.proj.toLonLat([a.passWayPoints[h][0],a.passWayPoints[h][1]]),l=GPS.gcj_encrypt(f[1],f[0]);b.push([l.lng,l.lat])}else for(h in a.passWayPoints)f=ol.proj.toLonLat([a.passWayPoints[h][0],a.passWayPoints[h][1]]),b.push([f[0],f[1]]);c.search(d,g,{waypoints:b},function(b,c){var d={status:!1};if(a.callback&&""!=a.callback&&"complete"==b){d.status=!0;var e=GPS.gcj_decrypt(c.origin.lat,c.origin.lng),e={lng:e.lng,lat:e.lat};d.origin=e;e=GPS.gcj_decrypt(c.destination.lat,c.destination.lng);e={lng:e.lng,lat:e.lat};d.destination=e;e={};e.policy=c.routes[0].policy;e.distance=c.routes[0].distance;e.time=c.routes[0].time;e.steps=[];for(var g=[],f=0;f<c.routes[0].steps.length;f++){var h={};h.start_location=c.routes[0].steps[f].start_location;h.end_location=c.routes[0].steps[f].end_location;h.instruction=c.routes[0].steps[f].instruction;h.action=c.routes[0].steps[f].action;h.orientation=c.routes[0].steps[f].orientation;h.road=c.routes[0].steps[f].road;h.distance=c.routes[0].steps[f].distance;h.time=c.routes[0].steps[f].time;var k=c.routes[0].steps[f].path,l=[],n;for(n in k){var q=GPS.gcj_decrypt(k[n].lat,k[n].lng),q={GPSLng:q.lng,GPSLat:q.lat};l.push(q)}h.path=l;e.steps.push(h);g=g.concat(l)}d.paths=g;d.routes=e}a.callback&&a.callback(d);var g={icon1:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],size:[19,31],src:"http://webapi.amap.com/theme/v1.3/markers/n/start.png"}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:"\u8d77\u70b9",fill:new ol.style.Fill({color:"#aa3300"}),offsetX:15,offsetY:-15,stroke:new ol.style.Stroke({color:"#fff",width:2}),textAlign:"left"})}),icon2:new ol.style.Style({image:new ol.style.Icon({anchor:[.5,1],size:[19,31],src:"http://webapi.amap.com/theme/v1.3/markers/n/end.png"}),text:new ol.style.Text({font:"13px Microsoft Yahei",text:"\u7ec8\u70b9",offsetX:15,offsetY:-15,fill:new ol.style.Fill({color:"#aa3300"}),stroke:new ol.style.Stroke({color:"#fff",width:2}),textAlign:"left"})})},h=[],q=new ol.style.Style({stroke:new ol.style.Stroke({width:5,color:[237,212,0,.8]})}),k=new ol.style.Style({stroke:new ol.style.Stroke({width:5,lineDash:[4,6],color:RGBA("#cccccc",.8)})}),w=d.paths,l=[];n=[];e=[];for(f in w){var t=GPS.gcj_encrypt(w[f].GPSLat,w[f].GPSLng),t=ol.proj.fromLonLat([t.lng,t.lat]);12<=_ty_layers_id&&(t=[w[f].GPSLng,w[f].GPSLat],t=ol.proj.fromLonLat([t[0],t[1]]));l.push(t);n.push(t[0]);e.push(t[1])}f=new ol.Feature(new ol.geom.LineString(l));f.setStyle(q);h.push(f);q=[d.origin.lng,d.origin.lat];f=[d.destination.lng,d.destination.lat];q=GPS.gcj_encrypt(q[1],q[0]);f=GPS.gcj_encrypt(f[1],f[0]);q=[q.lng,q.lat];f=[f.lng,f.lat];12<=_ty_layers_id&&(q=[d.origin.lng,d.origin.lat],f=[d.destination.lng,d.destination.lat]);var A=ol.proj.fromLonLat([q[0],q[1]]),z=ol.proj.fromLonLat([f[0],f[1]]),f=new ol.Feature(new ol.geom.LineString([A,l[0]]));f.setStyle(k);h.push(f);f=new ol.Feature(new ol.geom.LineString([z,l[l.length-1]]));f.setStyle(k);h.push(f);f=new ol.Feature({type:"icon1",geometry:new ol.geom.Point([A[0],A[1]])});f.setStyle(g.icon1);h.push(f);f=new ol.Feature({type:"icon2",geometry:new ol.geom.Point([z[0],z[1]])});f.setStyle(g.icon2);h.push(f);f=new ol.layer.Vector({zIndex:5E4,source:new ol.source.Vector({features:h})});_map.addLayer(f);_ty_cluster.push(f);_map.getView().fit([n.sort()[0],e.sort()[0],n.sort()[n.sort().length-1],e.sort()[e.sort().length-1]],_map.getSize());var x=d.routes.steps;$(".amap-lib-driving").find("dl").find("dt").each(function(a){$(this).click(function(){_ty_hdxg2();if(0==a)_map.getView().setCenter(A);else if(a==x.length+1)_map.getView().setCenter(z);else{var b=ol.proj.fromLonLat([x[a-1].end_location.lng,x[a-1].end_location.lat]),c=ol.proj.fromLonLat([x[a-1].start_location.lng,x[a-1].start_location.lat]),d=[];d.push(b[0]);d.push(c[0]);var e=[];e.push(b[1]);e.push(c[1]);_map.getView().fit([d.sort()[0],e.sort()[0],d.sort()[d.sort().length-1],e.sort()[e.sort().length-1]],_map.getSize())}})})})}catch(k){console.log(k.message)}},TYHeatMap=function(a){a.heatMapState.isClearOverlay&&TYClear();a||console.log("\u53c2\u6570\u7f3a\u5931");a.heatMapData.DataSet||console.log("\u6570\u636e\u7f3a\u5931");var e=[],b=[],c=[],d;for(d in a.heatMapData.DataSet){var g=ol.proj.fromLonLat([a.heatMapData.DataSet[d].lng,a.heatMapData.DataSet[d].lat]),h=new ol.Feature({geometry:new ol.geom.Point(g)});e.push(h);b.push(g[0]);c.push(g[1])}a=new ol.source.Vector({features:e});a=new ol.layer.Heatmap({source:a,gradient:["#00f","#0ff","#0f0","#ff0","#f00"],radius:15,blur:13,zIndex:6E4,opacity:.5});_map.addLayer(a);_ty_cluster.push(a);_ty_box(b,c)},TYClear=function(a){if(0==a){TYDrawStop(!1);if(_ty_point)for(var e in _ty_point)_map.unByKey(_ty_point);if(__ty_interaction)for(e in __ty_interaction)_map.removeInteraction(__ty_interaction[e])}else{TYDrawStop(!0);if(_ty_point)for(e in _ty_point)_map.unByKey(_ty_point);if(_ty_cluster)for(e in _ty_cluster)_map.removeLayer(_ty_cluster[e]);if(__ty_interaction)for(e in __ty_interaction)_map.removeInteraction(__ty_interaction[e]);if(_map&&_ty_popup)for(e in _ty_popup)_map.removeOverlay(_ty_popup[e])}},TYRemove=function(a){var e=0;try{return _map.getLayers().forEach(function(b){100<b.getZIndex()&&b.getSource()&&b.getSource().getFeatureById(a)&&(e++,b.getSource().removeFeature(b.getSource().getFeatureById(a)))}),e}catch(b){console.log(b.message)}};function TYLngLat_Normal(a,e){return ol.proj.fromLonLat([Number(a),Number(e)])}function TYLngLat(a,e){_ty_layers_id||console.log("\u5168\u5c40\u53c2\u6570\u7f3a\u5931");var b;b=12<=_ty_layers_id?{lng:a,lat:e}:GPS.gcj_encrypt(e,a);return ol.proj.fromLonLat([b.lng,b.lat])}function GPSLngLat(a,e){var b=ol.proj.toLonLat([a,e]),b=12<=_ty_layers_id?{lng:b[0],lat:b[1]}:GPS.gcj_decrypt(b[1],b[0]);return{GPSLng:b.lng,GPSLat:b.lat}}function TYOverlayEvent(a){this.mouseEvent=TYEnumEvent.TY_CLICK;a&&(a.mouseEvent&&(this.mouseEvent=a.mouseEvent),a.mouseFunc&&(this.mouseFunc=a.mouseFunc))}var GPS={PI:3.141592653589793,x_pi:52.35987755982988,delta:function(a,e){var b=this.transformLat(e-105,a-35),c=this.transformLon(e-105,a-35),d=a/180*this.PI,g=Math.sin(d),g=1-.006693421622965943*g*g,h=Math.sqrt(g),b=180*b/(6335552.717000426/(g*h)*this.PI),c=180*c/(6378245/h*Math.cos(d)*this.PI);return{lat:b,lng:c}},gcj_encrypt:function(a,e){if(this.outOfChina(a,e))return new TYLngLat_Normal(e,a);var b=this.delta(a,e);return{lng:e+b.lng,lat:a+b.lat}},gcj_decrypt:function(a,e){if(this.outOfChina(a,e))return{lat:a,lng:e};var b=this.delta(a,e);return{lng:e-b.lng,lat:a-b.lat}},gcj_decrypt_exact:function(a,e){for(var b=.01,c=.01,d=a-b,g=e-c,h=a+b,f=e+c,l,k,n=0;;){l=(d+h)/2;k=(g+f)/2;c=this.gcj_encrypt(l,k);b=c.lat-a;c=c.lng-e;if(1E-9>Math.abs(b)&&1E-9>Math.abs(c))break;0<b?h=l:d=l;0<c?f=k:g=k;if(1E4<++n)break}return{lng:k,lat:k}},bd_encrypt:function(a,e){var b=Math.sqrt(e*e+a*a)+2E-5*Math.sin(a*this.x_pi),c=Math.atan2(a,e)+3E-6*Math.cos(e*this.x_pi);bdLon=b*Math.cos(c)+.0065;bdLat=b*Math.sin(c)+.006;return{lat:bdLat,lng:bdLon}},bd_decrypt:function(a,e){var b=e-.0065,c=a-.006,d=Math.sqrt(b*b+c*c)-2E-5*Math.sin(c*this.x_pi),b=Math.atan2(c,b)-3E-6*Math.cos(b*this.x_pi);return{lat:d*Math.sin(b),lng:d*Math.cos(b)}},distance:function(a,e,b,c){a=Math.cos(a*Math.PI/180)*Math.cos(b*Math.PI/180)*Math.cos((e-c)*Math.PI/180)+Math.sin(a*Math.PI/180)*Math.sin(b*Math.PI/180);1<a&&(a=1);-1>a&&(a=-1);return 6371E3*Math.acos(a)},outOfChina:function(a,e){return 72.004>e||137.8347<e||.8293>a||55.8271<a?!0:!1},transformLat:function(a,e){var b=-100+2*a+3*e+.2*e*e+.1*a*e+.2*Math.sqrt(Math.abs(a)),b=b+2*(20*Math.sin(6*a*this.PI)+20*Math.sin(2*a*this.PI))/3,b=b+2*(20*Math.sin(e*this.PI)+40*Math.sin(e/3*this.PI))/3;return b+=2*(160*Math.sin(e/12*this.PI)+320*Math.sin(e*this.PI/30))/3},transformLon:function(a,e){var b=300+a+2*e+.1*a*a+.1*a*e+.1*Math.sqrt(Math.abs(a)),b=b+2*(20*Math.sin(6*a*this.PI)+20*Math.sin(2*a*this.PI))/3,b=b+2*(20*Math.sin(a*this.PI)+40*Math.sin(a/3*this.PI))/3;return b+=2*(150*Math.sin(a/12*this.PI)+300*Math.sin(a/30*this.PI))/3}};function _ty_hdxg(){_ty_hdxg2()}function _ty_hdxg2(){var a=ol.animation.pan({duration:2E3,source:_map.getView().getCenter()});_map.beforeRender(a)}function _TYRe(a,e){var b=_map.getView().getCenter();e?(b=ol.proj.toLonLat(b),b=GPS.gcj_decrypt(b[1],b[0])):(b=ol.proj.toLonLat(b),b=GPS.gcj_encrypt(b[1],b[0]));b=ol.proj.fromLonLat([b.lng,b.lat]);_map.getView().setCenter(b);if("TYDistrictSearch"==a[0])TYDistrictSearch(a[1],!0);else if("point"==a[0]){if(e)if(a[1].pointData.length)for(var c=0;c<a[1].pointData.length;c++)b=ol.proj.toLonLat([a[1].pointData[c].lnglat[0],a[1].pointData[c].lnglat[1]]),b=GPS.gcj_decrypt(b[1],b[0]),a[1].pointData[c].lnglat=ol.proj.fromLonLat([b.lng,b.lat]);else b=ol.proj.toLonLat([a[1].pointData.lnglat[0],a[1].pointData.lnglat[1]]),b=GPS.gcj_decrypt(b[1],b[0]),a[1].pointData.lnglat=ol.proj.fromLonLat([b.lng,b.lat]);else if(a[1].pointData.length)for(c=0;c<a[1].pointData.length;c++)b=ol.proj.toLonLat([a[1].pointData[c].lnglat[0],a[1].pointData[c].lnglat[1]]),b=GPS.gcj_encrypt(b[1],b[0]),a[1].pointData[c].lnglat=ol.proj.fromLonLat([b.lng,b.lat]);else b=ol.proj.toLonLat([a[1].pointData.lnglat[0],a[1].pointData.lnglat[1]]),b=GPS.gcj_encrypt(b[1],b[0]),a[1].pointData.lnglat=ol.proj.fromLonLat([b.lng,b.lat]);a[1].pointState.isSetView=!1;TYDrawPoint(a[1],!0)}else if("line"==a[0]){if(e)if(a[1].lineData.length)for(c=0;c<a[1].lineData.length;c++)for(b=0;b<a[1].lineData[c].lnglat.length;b++){var d=ol.proj.toLonLat([a[1].lineData[c].lnglat[b][0],a[1].lineData[c].lnglat[b][1]]),d=GPS.gcj_decrypt(d[1],d[0]);a[1].lineData[c].lnglat[b]=ol.proj.fromLonLat([d.lng,d.lat])}else for(b=0;b<a[1].lineData.lnglat.length;b++)d=ol.proj.toLonLat([a[1].lineData.lnglat[b][0],a[1].lineData.lnglat[b][1]]),d=GPS.gcj_decrypt(d[1],d[0]),a[1].lineData.lnglat[b]=ol.proj.fromLonLat([d.lng,d.lat]);else if(a[1].lineData.length)for(c=0;c<a[1].lineData.length;c++)for(b=0;b<a[1].lineData[c].lnglat.length;b++)d=ol.proj.toLonLat([a[1].lineData[c].lnglat[b][0],a[1].lineData[c].lnglat[b][1]]),d=GPS.gcj_encrypt(d[1],d[0]),a[1].lineData[c].lnglat[b]=ol.proj.fromLonLat([d.lng,d.lat]);else for(b=0;b<a[1].lineData.lnglat.length;b++)d=ol.proj.toLonLat([a[1].lineData.lnglat[b][0],a[1].lineData.lnglat[b][1]]),d=GPS.gcj_encrypt(d[1],d[0]),a[1].lineData.lnglat[b]=ol.proj.fromLonLat([d.lng,d.lat]);a[1].lineState.isSetView=!1;TYDrawLine(a[1],!0)}else if("rect"==a[0]){if(e)if(a[1].rectangleData.length)for(c=0;c<a[1].rectangleData.length;c++)b=ol.proj.toLonLat([a[1].rectangleData[c].t_r_LngLat[0],a[1].rectangleData[c].t_r_LngLat[1]]),d=ol.proj.toLonLat([a[1].rectangleData[c].b_l_LngLat[0],a[1].rectangleData[c].b_l_LngLat[1]]),b=GPS.gcj_decrypt(b[1],b[0]),d=GPS.gcj_decrypt(d[1],d[0]),a[1].rectangleData[c].t_r_LngLat=ol.proj.fromLonLat([b.lng,b.lat]),a[1].rectangleData[c].b_l_LngLat=ol.proj.fromLonLat([d.lng,d.lat]);else b=ol.proj.toLonLat([a[1].rectangleData.t_r_LngLat[0],a[1].rectangleData.t_r_LngLat[1]]),d=ol.proj.toLonLat([a[1].rectangleData.b_l_LngLat[0],a[1].rectangleData.b_l_LngLat[1]]),b=GPS.gcj_decrypt(b[1],b[0]),d=GPS.gcj_decrypt(d[1],d[0]),a[1].rectangleData.t_r_LngLat=ol.proj.fromLonLat([b.lng,b.lat]),a[1].rectangleData.b_l_LngLat=ol.proj.fromLonLat([d.lng,d.lat]);else if(a[1].rectangleData.length)for(c=0;c<a[1].rectangleData.length;c++)b=ol.proj.toLonLat([a[1].rectangleData[c].t_r_LngLat[0],a[1].rectangleData[c].t_r_LngLat[1]]),d=ol.proj.toLonLat([a[1].rectangleData[c].b_l_LngLat[0],a[1].rectangleData[c].b_l_LngLat[1]]),b=GPS.gcj_encrypt(b[1],b[0]),d=GPS.gcj_encrypt(d[1],d[0]),a[1].rectangleData[c].t_r_LngLat=ol.proj.fromLonLat([b.lng,b.lat]),a[1].rectangleData[c].b_l_LngLat=ol.proj.fromLonLat([d.lng,d.lat]);else b=ol.proj.toLonLat([a[1].rectangleData.t_r_LngLat[0],a[1].rectangleData.t_r_LngLat[1]]),d=ol.proj.toLonLat([a[1].rectangleData.b_l_LngLat[0],a[1].rectangleData.b_l_LngLat[1]]),b=GPS.gcj_encrypt(b[1],b[0]),d=GPS.gcj_encrypt(d[1],d[0]),a[1].rectangleData.t_r_LngLat=ol.proj.fromLonLat([b.lng,b.lat]),a[1].rectangleData.b_l_LngLat=ol.proj.fromLonLat([d.lng,d.lat]);a[1].rectangleState.isSetView=!1;TYDrawRectangle(a[1],!0)}else if("polygon"==a[0]){if(e)if(a[1].polygonData.length)for(c=0;c<a[1].polygonData.length;c++)for(b=0;b<a[1].polygonData[c].lnglat.length;b++)d=ol.proj.toLonLat([a[1].polygonData[c].lnglat[b][0],a[1].polygonData[c].lnglat[b][1]]),d=GPS.gcj_decrypt(d[1],d[0]),a[1].polygonData[c].lnglat[b]=ol.proj.fromLonLat([d.lng,d.lat]);else for(b=0;b<a[1].polygonData.lnglat.length;b++)d=ol.proj.toLonLat([a[1].polygonData.lnglat[b][0],a[1].polygonData.lnglat[b][1]]),d=GPS.gcj_decrypt(d[1],d[0]),a[1].polygonData.lnglat[b]=ol.proj.fromLonLat([d.lng,d.lat]);else if(a[1].polygonData.length)for(c=0;c<a[1].polygonData.length;c++)for(b=0;b<a[1].polygonData[c].lnglat.length;b++)d=ol.proj.toLonLat([a[1].polygonData[c].lnglat[b][0],a[1].polygonData[c].lnglat[b][1]]),d=GPS.gcj_encrypt(d[1],d[0]),a[1].polygonData[c].lnglat[b]=ol.proj.fromLonLat([d.lng,d.lat]);else for(b=0;b<a[1].polygonData.lnglat.length;b++)d=ol.proj.toLonLat([a[1].polygonData.lnglat[b][0],a[1].polygonData.lnglat[b][1]]),d=GPS.gcj_encrypt(d[1],d[0]),a[1].polygonData.lnglat[b]=ol.proj.fromLonLat([d.lng,d.lat]);a[1].polygonState.isSetView=!1;TYDrawPolygon(a[1],!0)}else if("TYMoveLocus"==a[0]){for(b=0;b<a[1].locusData.lnglat.length;b++)c=ol.proj.toLonLat([a[1].locusData.lnglat[b][0],a[1].locusData.lnglat[b][1]]),c=e?GPS.gcj_decrypt(c[1],c[0]):GPS.gcj_encrypt(c[1],c[0]),a[1].locusData.lnglat[b]=ol.proj.fromLonLat([c.lng,c.lat]);a[1].locusState.isSetView=!1;TYMoveLocus(a[1],!0)}else if("TYAreaRender"==a[0]){for(b=0;b<a[1].renderDatas.length;b++)c=ol.proj.toLonLat([a[1].renderDatas.lnglat[b][0],a[1].renderDatas.lnglat[b][1]]),c=e?GPS.gcj_decrypt(c[1],c[0]):GPS.gcj_encrypt(c[1],c[0]),a[1].renderDatas.lnglat[b]=ol.proj.fromLonLat([c.lng,c.lat]);a[1].renderState.isSetView=!1;TYAreaRender(a[1],!0)}else if("circle"==a[0]){if(a[1].circleData.length)for(c=0;c<a[1].circleData.length;c++)b=ol.proj.toLonLat([a[1].circleData[c].lnglat[0],a[1].circleData[c].lnglat[1]]),b=e?GPS.gcj_decrypt(b[1],b[0]):GPS.gcj_encrypt(b[1],b[0]),a[1].circleData.lnglat[c]=ol.proj.fromLonLat([b.lng,b.lat]);else b=ol.proj.toLonLat([a[1].circleData.lnglat[0],a[1].circleData.lnglat[1]]),b=e?GPS.gcj_decrypt(b[1],b[0]):GPS.gcj_encrypt(b[1],b[0]),a[1].circleData.lnglat=ol.proj.fromLonLat([b.lng,b.lat]);a[1].circleState.isSetView=!1;TYDrawCircle(a[1],!0)}else if("TYDriving__\u6ce8\u91ca__"==a[0]){if(!e&&(b=ol.proj.toLonLat([a[1].origin[0],a[1].origin[1]]),d=ol.proj.toLonLat([a[1].destination[0],a[1].destination[1]]),b=GPS.gcj_encrypt(b[1],b[0]),d=GPS.gcj_encrypt(d[1],d[0]),a[1].origin=ol.proj.fromLonLat([b.lng,b.lat]),a[1].destination=ol.proj.fromLonLat([d.lng,d.lat]),a[1].passWayPoints&&0<a[1].passWayPoints.length)){b=[];for(c in a[1].passWayPoints)d=ol.proj.toLonLat([a[1].passWayPoints[c][0],a[1].passWayPoints[c][1]]),d=GPS.gcj_encrypt(d[1],d[0]),b.push(ol.proj.fromLonLat[d.lng,d.lat]);a[1].passWayPoints=b}TYDriving(a[1],!0)}}var TYWMSTilesOptions=function(a){a&&(this.styles=this.layers=this.MapType=this.Id="",this.format="image/jpeg",this.transparent=!1,this.version="1.1.1",this.srs="EPSG:4326",this.url="",this.IsTile=!0,null!=a.IsTile&&(this.IsTile=a.IsTile),null!=a.Id&&(this.Id=a.Id),null!=a.MapType&&(this.MapType=a.MapType),null!=a.layers&&(this.layers=a.layers),null!=a.styles&&(this.styles=a.styles),null!=a.format&&(this.format=a.format),null!=a.transparent&&(this.transparent=a.transparent),null!=a.version&&(this.version=a.version),null!=a.srs&&(this.srs=a.srs),null!=a.url&&(this.url=a.url))},_ty_wms_array=[],TYWMSTiles=function(a){if(void 0!=a.url&&""!=a.url.trim()){var e,b=a.url;0>b.indexOf("?")&&(b+="?");0>b.indexOf("http://")&&(b="http://"+b);""!=a.layers&&(b=b+"layers\x3d"+a.layers);""!=a.version&&(b=b+"\x26version\x3d"+a.version);""!=a.srs&&(b=b+"\x26srs\x3d"+a.srs);""!=a.format&&(b=b+"\x26format\x3d"+a.format);""!=a.styles&&(b=b+"\x26styles\x3d"+a.styles);""!=a.transparent&&(b=b+"\x26transparent\x3d"+a.transparent);e=new ol.source.XYZ({tileUrlFunction:function(a){var c=a[1],e=-(a[2]+1),h=_map.getView().getZoom(),f=new TransformClassNormal(28,3);a=f.pixelToLnglat(0,256,c,e,h);c=f.pixelToLnglat(256,0,c,e,h);e=GPS.gcj_decrypt(a.lat,a.lng);h=GPS.gcj_decrypt(c.lat,c.lng);bbox=12<=_ty_layers_id?[a.lng,a.lat,c.lng,c.lat]:[e.lng,e.lat,h.lng,h.lat];return b+"\x26service\x3dWMS\x26request\x3dGetMap\x26tiled\x3dtrue\x26bbox\x3d"+bbox.join(",")+"\x26width\x3d256\x26height\x3d256"}});e=new ol.layer.Tile({zIndex:999,source:e});_map.addLayer(e);e.Id="";""!=a.Id&&(e.Id=a.Id);_ty_wms_array.push(e)}},TYRemoveWMSTiles=function(a){if(a)for(var e=0;e<_ty_wms_array.length;e++)_ty_wms_array[e].Id&&_ty_wms_array[e].Id==a&&_map.removeLayer(_ty_wms_array[e]);else for(e=0;e<_ty_wms_array.length;e++)_map.removeLayer(_ty_wms_array[e])};function _Math_sinh(a){return(Math.exp(a)-Math.exp(-a))/2}var TransformClassNormal=function(a,e){this.levelMax=a;this.levelMin=e;this._getMapSize=function(a){return Math.pow(2,a)};this.getResolution=function(a,c){return 12756274*Math.PI*Math.cos(a)/256/this._getMapSize(c)};this._lngToTileX=function(a,c){return Math.floor((a+180)/360*this._getMapSize(c))};this._latToTileY=function(a,c){var b=a*Math.PI/180;return Math.floor((1-Math.log(Math.tan(b)+1/Math.cos(b))/Math.PI)/2*this._getMapSize(c))};this.lnglatToTile=function(a,c,d){var b={};b.tileX=this._lngToTileX(a,d);b.tileY=this._latToTileY(c,d);return b};this._lngToPixelX=function(a,c){return Math.round((a+180)/360*this._getMapSize(c)*256%256)};this._latToPixelY=function(a,c){var b=Math.sin(a*Math.PI/180);return Math.round((.5-Math.log((1+b)/(1-b))/(4*Math.PI))*this._getMapSize(c)*256%256)};this.lnglatToPixel=function(a,c,d){var b={};b.pixelX=this._lngToPixelX(a,d);b.pixelY=this._latToPixelY(c,d);return b};this._pixelXTolng=function(a,c,d){return(c+a/256)/this._getMapSize(d)*360-180};this._pixelYToLat=function(a,c,d){return 180*Math.atan(_Math_sinh(Math.PI*(1-2*(c+a/256)/this._getMapSize(d))))/Math.PI};this.pixelToLnglat=function(a,c,d,e,h){var b={};b.lng=this._pixelXTolng(a,d,h);b.lat=this._pixelYToLat(c,e,h);return b}};